<!DOCTYPE html>
<html lang="pt-BR">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>VILLA OBSCURA â€” A HeranÃ§a Maldita</title>
<style>
@import url('https://fonts.googleapis.com/css2?family=Cinzel+Decorative:wght@400;700;900&family=Cinzel:wght@400;500;600;700&family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;0,600;1,300;1,400;1,600&family=IM+Fell+English:ital@0;1&display=swap');

*,*::before,*::after{margin:0;padding:0;box-sizing:border-box}
html{font-size:16px;height:100%}
body{
  background:#06050a;
  color:#e0d4be;
  font-family:'Cormorant Garamond',serif;
  min-height:100vh;
  overflow-x:hidden;
}

body::before{
  content:'';
  position:fixed;inset:0;z-index:0;
  background:
    radial-gradient(ellipse at 20% 15%,rgba(160,100,20,.08) 0%,transparent 55%),
    radial-gradient(ellipse at 80% 85%,rgba(80,10,120,.10) 0%,transparent 55%),
    radial-gradient(ellipse at 50% 50%,rgba(10,5,25,.6) 0%,transparent 80%),
    url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='500' height='500'%3E%3Cfilter id='n'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.6' numOctaves='4' stitchTiles='stitch'/%3E%3CfeColorMatrix type='saturate' values='0'/%3E%3C/filter%3E%3Crect width='500' height='500' filter='url(%23n)' opacity='0.04'/%3E%3C/svg%3E");
  pointer-events:none;
}

:root{
  --bg:#06050a;
  --paper:#0e0c14;
  --paper2:#131020;
  --paper3:#181428;
  --paper4:#1e1930;
  --gold:#c49030;
  --gold2:#e0b050;
  --gold3:#f8d880;
  --gold4:rgba(196,144,48,.12);
  --purple:#6020a0;
  --purple2:#8030c0;
  --red:#8a1818;
  --red2:#c02828;
  --red3:#e04040;
  --ink:#e0d4be;
  --ink2:#a89870;
  --ink3:#70604a;
  --ink4:#3a3020;
  --border:rgba(196,144,48,.18);
  --border2:rgba(196,144,48,.08);
  --border3:rgba(196,144,48,.38);
  /* character colors */
  --c-pollyana:#c84820;
  --c-carluz:#d49010;
  --c-eros:#9030c0;
  --c-stephany:#2070c0;
  --c-mary:#209060;
  --c-mel:#c02858;
  --c-joy:#e05010;
  --c-ellie:#308090;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPLASH SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#splash{
  position:fixed;inset:0;z-index:300;
  display:flex;align-items:center;justify-content:center;
  background:var(--bg);
  overflow-y:auto;
  padding:20px;
}

.splash-wrap{
  max-width:780px;width:100%;
  text-align:center;
  position:relative;
}

.splash-frame-outer{
  border:1px solid rgba(196,144,48,.28);
  padding:5px;
  background:linear-gradient(135deg,rgba(196,144,48,.08),transparent 40%,rgba(128,30,200,.06));
}
.splash-frame-inner{
  border:1px solid rgba(196,144,48,.12);
  padding:64px 80px 56px;
  background:var(--paper);
  position:relative;
}
@media(max-width:640px){.splash-frame-inner{padding:40px 24px 36px}}

.sp-corner{position:absolute;width:32px;height:32px;border-color:var(--gold);border-style:solid;}
.sp-corner.tl{top:-1px;left:-1px;border-width:2px 0 0 2px}
.sp-corner.tr{top:-1px;right:-1px;border-width:2px 2px 0 0}
.sp-corner.bl{bottom:-1px;left:-1px;border-width:0 0 2px 2px}
.sp-corner.br{bottom:-1px;right:-1px;border-width:0 2px 2px 0}

.sp-eyebrow{
  font-family:'Cinzel',serif;
  font-size:10px;letter-spacing:12px;
  color:rgba(196,144,48,.5);
  margin-bottom:28px;
  text-transform:uppercase;
}

.sp-title-top{
  font-family:'Cinzel Decorative',serif;
  font-size:clamp(48px,11vw,96px);
  font-weight:900;
  line-height:1;
  letter-spacing:8px;
  background:linear-gradient(180deg,var(--gold3) 0%,var(--gold) 55%,#7a5010 100%);
  -webkit-background-clip:text;
  background-clip:text;
  color:transparent;
  margin-bottom:0;
}
.sp-title-bottom{
  font-family:'Cinzel',serif;
  font-size:clamp(14px,3vw,22px);
  letter-spacing:22px;
  color:rgba(160,120,40,.6);
  margin-bottom:10px;
}

.sp-subtitle{
  font-family:'IM Fell English',serif;
  font-style:italic;
  font-size:clamp(16px,3vw,21px);
  color:var(--gold2);
  letter-spacing:3px;
  margin-bottom:4px;
}

.sp-divider{
  display:flex;align-items:center;gap:14px;
  margin:28px auto;
  max-width:460px;
}
.sp-divider::before,.sp-divider::after{
  content:'';flex:1;height:1px;
  background:linear-gradient(to right,transparent,rgba(196,144,48,.4),transparent);
}
.sp-divider-icon{
  font-size:10px;color:var(--gold);opacity:.7;
  font-family:'Cinzel',serif;
  letter-spacing:4px;
}

.sp-premise{
  font-family:'Cormorant Garamond',serif;
  font-size:clamp(15px,2.5vw,17px);
  line-height:2.1;
  color:var(--ink2);
  font-style:italic;
  margin-bottom:16px;
  max-width:580px;
  margin-left:auto;margin-right:auto;
}
.sp-premise strong{color:var(--ink);font-style:normal}

.sp-cast{
  display:flex;flex-wrap:wrap;justify-content:center;gap:10px;
  margin-bottom:36px;
}
.sp-cast-tag{
  font-family:'Cinzel',serif;
  font-size:9px;letter-spacing:3px;
  padding:6px 14px;
  border:1px solid var(--border);
  color:var(--ink3);
  background:rgba(255,255,255,.02);
}

.sp-mechanics{
  display:grid;grid-template-columns:repeat(auto-fit,minmax(160px,1fr));
  gap:12px;margin-bottom:36px;text-align:left;
}
.sp-mech{
  padding:14px 16px;
  border:1px solid var(--border2);
  background:rgba(255,255,255,.02);
}
.sp-mech-icon{font-size:20px;margin-bottom:8px}
.sp-mech-title{
  font-family:'Cinzel',serif;
  font-size:9px;letter-spacing:3px;color:var(--gold);
  margin-bottom:4px;
}
.sp-mech-text{font-size:12px;color:var(--ink3);line-height:1.6;font-style:italic}

.sp-btn{
  font-family:'Cinzel',serif;
  font-size:13px;font-weight:600;
  letter-spacing:8px;
  padding:20px 64px;
  background:transparent;
  border:1px solid var(--gold);
  color:var(--gold2);
  cursor:pointer;
  transition:all .4s;
  position:relative;overflow:hidden;
  text-transform:uppercase;
}
.sp-btn::before{
  content:'';position:absolute;inset:0;
  background:linear-gradient(135deg,var(--gold),var(--gold2));
  transform:scaleX(0);transform-origin:left;
  transition:transform .5s cubic-bezier(.4,0,.2,1);
}
.sp-btn:hover::before{transform:scaleX(1)}
.sp-btn:hover{color:#000;border-color:var(--gold2)}
.sp-btn span{position:relative;z-index:1}

.sp-warn{
  font-size:10px;letter-spacing:2px;
  color:rgba(255,255,255,.2);margin-top:20px;
  font-family:'Cinzel',serif;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   GAME LAYOUT
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#game{display:none;min-height:100vh;position:relative;z-index:1}

/* TOP BAR */
#topbar{
  position:sticky;top:0;z-index:100;
  background:rgba(14,12,20,.96);
  border-bottom:1px solid var(--border);
  padding:0 28px;
  display:flex;align-items:center;justify-content:space-between;
  height:60px;
  backdrop-filter:blur(16px);
}

.tb-logo{
  font-family:'Cinzel Decorative',serif;
  font-size:16px;font-weight:700;
  letter-spacing:4px;
  background:linear-gradient(135deg,var(--gold3),var(--gold));
  -webkit-background-clip:text;background-clip:text;color:transparent;
}

.tb-center{display:flex;gap:28px;align-items:center}

.tb-stat{display:flex;flex-direction:column;align-items:center;gap:2px}
.tb-stat-val{
  font-family:'Cinzel',serif;
  font-size:15px;font-weight:600;color:var(--gold2);
}
.tb-stat-lbl{font-size:7px;letter-spacing:4px;color:var(--ink3);font-weight:300;text-transform:uppercase}

.tb-right{display:flex;gap:12px;align-items:center}

.tb-phase{
  font-family:'Cinzel',serif;
  font-size:9px;letter-spacing:4px;
  color:var(--ink3);
  padding:6px 12px;
  border:1px solid var(--border2);
}

.btn-accuse{
  font-family:'Cinzel',serif;
  font-size:10px;font-weight:600;
  letter-spacing:4px;
  padding:10px 22px;
  background:var(--red);
  border:1px solid var(--red2);
  color:#f0c0c0;cursor:pointer;
  transition:all .3s;
  display:none;text-transform:uppercase;
}
.btn-accuse:hover{background:var(--red2)}
.btn-accuse.visible{display:block;animation:pulseRed 2s ease-in-out infinite}
@keyframes pulseRed{0%,100%{box-shadow:0 0 0 0 rgba(192,40,40,.3)}50%{box-shadow:0 0 0 6px rgba(192,40,40,0)}}

/* MAIN GRID */
#game-main{
  display:grid;
  grid-template-columns:300px 1fr 320px;
  min-height:calc(100vh - 60px);
}

/* â”€â”€ LEFT PANEL â”€â”€ */
#panel-left{
  background:var(--paper);
  border-right:1px solid var(--border);
  display:flex;flex-direction:column;
  overflow-y:auto;
  max-height:calc(100vh - 60px);
  position:sticky;top:60px;
}

.panel-section{
  padding:18px 20px;
  border-bottom:1px solid var(--border2);
}

.p-label{
  font-family:'Cinzel',serif;
  font-size:8px;font-weight:600;
  letter-spacing:5px;color:var(--gold);
  opacity:.65;margin-bottom:14px;
  text-transform:uppercase;
}

/* Evidence */
.evidence-item{
  display:flex;align-items:flex-start;gap:10px;
  padding:10px;border:1px solid transparent;
  margin-bottom:6px;cursor:pointer;transition:all .25s;
}
.evidence-item:hover{background:var(--paper2);border-color:var(--border2)}
.evidence-item.new{border-color:var(--gold);background:rgba(196,144,48,.07);
  animation:evFlash .6s ease}
@keyframes evFlash{0%{background:rgba(196,144,48,.3)}100%{background:rgba(196,144,48,.07)}}

.ev-icon{font-size:18px;flex-shrink:0;margin-top:2px;line-height:1}
.ev-name{
  font-family:'Cinzel',serif;
  font-size:11px;letter-spacing:1px;color:var(--ink);margin-bottom:3px;
}
.ev-desc{font-size:12px;color:var(--ink3);line-height:1.5;font-style:italic}
.ev-badge{
  font-family:'Cinzel',serif;font-size:7px;letter-spacing:2px;
  background:var(--gold);color:#000;padding:2px 6px;margin-left:6px;
}

/* Alibi tracker */
.alibi-item{
  display:flex;align-items:center;gap:8px;
  padding:7px 8px;
  border:1px solid var(--border2);
  margin-bottom:5px;
  transition:border-color .3s;
  cursor:pointer;
}
.alibi-item:hover{background:var(--paper2)}
.alibi-item.suspect{border-color:rgba(192,40,40,.4)}
.alibi-item.cleared{border-color:rgba(32,144,96,.4)}
.alibi-item.partial{border-color:rgba(196,144,48,.4)}

.alibi-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0}
.alibi-name{
  font-family:'Cinzel',serif;
  font-size:11px;letter-spacing:1px;color:var(--ink);flex:1;
}
.alibi-tag{font-size:9px;letter-spacing:1px;color:var(--ink3)}
.alibi-tag.lied{color:var(--red3)}
.alibi-tag.ok{color:#40c080}
.alibi-tag.partial{color:var(--gold2)}

/* Notes */
#notes-area{
  font-family:'IM Fell English',serif;
  font-style:italic;
  font-size:13px;
  color:var(--ink2);
  line-height:2;
  min-height:140px;
  padding:10px;
  background:rgba(0,0,0,.25);
  border:1px solid var(--border2);
  width:100%;
  resize:vertical;
  outline:none;
}
#notes-area::placeholder{color:var(--ink4);font-style:italic}
#notes-area:focus{border-color:rgba(196,144,48,.3)}

/* Timeline */
.timeline-entry{
  display:flex;gap:10px;padding:8px 0;
  border-bottom:1px solid var(--border2);
  font-size:12px;
}
.tl-time{
  font-family:'Cinzel',serif;
  font-size:10px;color:var(--gold);
  letter-spacing:1px;flex-shrink:0;
  width:36px;text-align:right;
}
.tl-text{color:var(--ink3);line-height:1.5;font-style:italic}
.tl-text strong{color:var(--ink2);font-style:normal}

/* â”€â”€ CENTER PANEL â”€â”€ */
#panel-center{
  padding:36px 44px;
  overflow-y:auto;
  max-height:calc(100vh - 60px);
}

/* Header */
.center-header{
  text-align:center;
  border-bottom:2px double rgba(196,144,48,.25);
  padding-bottom:28px;
  margin-bottom:36px;
  position:relative;
}
.ch-kicker{
  font-family:'Cinzel',serif;
  font-size:9px;letter-spacing:10px;
  color:var(--ink4);margin-bottom:16px;
  text-transform:uppercase;
}
.ch-headline{
  font-family:'Cinzel',serif;
  font-size:clamp(26px,5vw,46px);
  font-weight:700;
  line-height:1.1;color:var(--ink);
  margin-bottom:10px;
  letter-spacing:2px;
}
.ch-sub{
  font-family:'Cormorant Garamond',serif;
  font-style:italic;
  font-size:clamp(15px,2.5vw,18px);
  color:var(--ink2);
  margin-bottom:14px;
  line-height:1.6;
}
.ch-meta{
  display:flex;gap:24px;justify-content:center;flex-wrap:wrap;
  font-family:'Cinzel',serif;
  font-size:9px;letter-spacing:3px;color:var(--ink4);
}

/* Report box */
.report-box{
  border:1px solid var(--border);
  padding:28px 32px;
  background:var(--paper2);
  margin-bottom:36px;
  position:relative;
}
.report-box::before{
  content:'RELATÃ“RIO INICIAL â€” DOSSIÃŠ CONFIDENCIAL';
  position:absolute;top:-10px;left:24px;
  background:var(--paper2);padding:0 12px;
  font-family:'Cinzel',serif;font-size:8px;letter-spacing:4px;color:var(--gold);
}
.report-text{
  font-size:clamp(14px,2vw,16px);
  line-height:2.1;color:var(--ink2);
}
.report-text strong{color:var(--ink);font-weight:600}

/* Phase banner */
.phase-banner{
  display:flex;align-items:center;gap:16px;
  padding:14px 20px;
  border:1px solid var(--gold);
  background:rgba(196,144,48,.07);
  margin-bottom:28px;
}
.phase-banner-icon{font-size:22px}
.phase-banner-body{}
.phase-banner-title{
  font-family:'Cinzel',serif;
  font-size:11px;letter-spacing:4px;color:var(--gold2);
  margin-bottom:3px;text-transform:uppercase;
}
.phase-banner-text{font-size:13px;color:var(--ink2);font-style:italic}

/* Section title */
.sec-title{
  font-family:'Cinzel',serif;
  font-size:10px;font-weight:600;
  letter-spacing:7px;color:var(--gold);
  margin-bottom:20px;
  display:flex;align-items:center;gap:14px;
  text-transform:uppercase;
}
.sec-title::before,.sec-title::after{
  content:'';flex:1;height:1px;
  background:linear-gradient(to right,transparent,var(--border));
}
.sec-title::after{background:linear-gradient(to left,transparent,var(--border))}

/* Room grid */
.rooms-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(170px,1fr));
  gap:12px;margin-bottom:36px;
}

.room-card{
  border:1px solid var(--border);
  padding:22px 18px;
  background:var(--paper);
  cursor:pointer;
  transition:all .35s;
  position:relative;overflow:hidden;
}
.room-card::after{
  content:'';position:absolute;
  bottom:0;left:0;right:0;height:2px;
  background:var(--card-color,var(--gold));
  transform:scaleX(0);transform-origin:left;
  transition:transform .35s cubic-bezier(.4,0,.2,1);
}
.room-card:hover{
  background:var(--paper2);
  border-color:rgba(196,144,48,.4);
  transform:translateY(-2px);
  box-shadow:0 8px 32px rgba(0,0,0,.4);
}
.room-card:hover::after{transform:scaleX(1)}
.room-card.visited{opacity:.55}
.room-card.visited .room-check{display:block}
.room-card.has-unread{border-color:rgba(196,144,48,.5)}
.room-card.has-unread .room-icon{animation:glowPulse 2.5s ease-in-out infinite}
@keyframes glowPulse{0%,100%{filter:none}50%{filter:drop-shadow(0 0 10px var(--gold2))}}

.room-icon{font-size:30px;margin-bottom:12px;display:block;line-height:1}
.room-name{
  font-family:'Cinzel',serif;
  font-size:13px;letter-spacing:2px;color:var(--ink);margin-bottom:4px;
}
.room-hint{font-size:11px;font-style:italic;color:var(--ink3)}
.room-check{
  display:none;position:absolute;top:10px;right:12px;
  font-family:'Cinzel',serif;font-size:11px;color:var(--gold);
}
.room-clue-count{
  position:absolute;bottom:10px;right:12px;
  font-family:'Cinzel',serif;font-size:9px;letter-spacing:2px;
  color:var(--ink3);
}

/* Character grid */
.chars-grid{
  display:grid;
  grid-template-columns:repeat(auto-fill,minmax(180px,1fr));
  gap:12px;margin-bottom:36px;
}

.char-card{
  border:1px solid var(--border);
  background:var(--paper);
  cursor:pointer;
  transition:all .3s;
  overflow:hidden;position:relative;
}
.char-card:hover{
  border-color:rgba(196,144,48,.45);
  transform:translateY(-3px);
  box-shadow:0 10px 40px rgba(0,0,0,.5);
}

.char-card-banner{
  height:72px;
  display:flex;align-items:center;justify-content:center;
  font-size:34px;
  position:relative;overflow:hidden;
}
.char-card-banner::before{
  content:'';position:absolute;inset:0;
  background:inherit;opacity:.4;
}

.char-card-info{padding:14px 16px}
.char-card-name{
  font-family:'Cinzel',serif;
  font-size:14px;letter-spacing:2px;color:var(--ink);margin-bottom:3px;
}
.char-card-role{font-size:11px;font-style:italic;color:var(--ink3)}
.char-card-alibi{font-size:10px;color:var(--ink4);margin-top:4px;letter-spacing:.5px}

.char-badge{
  position:absolute;top:8px;right:8px;
  font-family:'Cinzel',serif;font-size:7px;letter-spacing:2px;
  padding:3px 8px;text-transform:uppercase;
}
.char-badge.suspect{background:rgba(138,24,24,.6);color:#f0c0c0;border:1px solid rgba(192,40,40,.4)}
.char-badge.cleared{background:rgba(20,120,70,.5);color:#a0f0c0;border:1px solid rgba(40,192,120,.3)}
.char-badge.key{background:rgba(128,30,200,.5);color:#e0c0ff;border:1px solid rgba(160,60,220,.4)}

.char-interro-count{
  position:absolute;bottom:8px;right:10px;
  font-size:10px;color:var(--ink4);font-style:italic;
}

/* â”€â”€ RIGHT PANEL â”€â”€ */
#panel-right{
  background:var(--paper);
  border-left:1px solid var(--border);
  display:flex;flex-direction:column;
  overflow-y:auto;
  max-height:calc(100vh - 60px);
  position:sticky;top:60px;
}

.ded-header{
  padding:18px 20px;
  border-bottom:1px solid var(--border2);
  font-family:'Cinzel',serif;
  font-size:9px;letter-spacing:6px;color:var(--gold);opacity:.65;
  text-transform:uppercase;
}

/* Suspect meters */
.suspect-row{
  padding:10px 16px 12px;
  border-bottom:1px solid var(--border2);
  cursor:pointer;
  transition:background .2s;
}
.suspect-row:hover{background:var(--paper2)}

.sr-top{display:flex;align-items:center;gap:8px;margin-bottom:4px}
.sr-dot{width:9px;height:9px;border-radius:50%;flex-shrink:0}
.sr-name{
  font-family:'Cinzel',serif;
  font-size:12px;letter-spacing:1px;color:var(--ink);flex:1;
}
.sr-pts{
  font-family:'Cinzel',serif;
  font-size:12px;font-weight:600;color:var(--gold2);
}

.sr-bar{height:2px;background:rgba(255,255,255,.05);border-radius:1px;overflow:hidden;margin-bottom:4px}
.sr-fill{height:100%;border-radius:1px;transition:width 1.2s cubic-bezier(.4,0,.2,1)}
.sr-verdict{font-size:9px;letter-spacing:1.5px;color:var(--ink3);font-style:italic}

/* Connections web */
.connection-item{
  display:flex;align-items:flex-start;gap:10px;
  padding:10px 0;border-bottom:1px solid var(--border2);
  font-size:12px;
}
.conn-names{
  font-family:'Cinzel',serif;font-size:10px;letter-spacing:1px;
  color:var(--gold2);min-width:110px;flex-shrink:0;
}
.conn-desc{color:var(--ink3);font-style:italic;line-height:1.5}

/* Theory */
.theory-box{padding:18px 20px;border-bottom:1px solid var(--border2)}
.theory-section{margin-bottom:16px}
.theory-label{
  font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;
  color:var(--gold);margin-bottom:8px;text-transform:uppercase;
}
.theory-select{
  width:100%;
  background:var(--paper2);
  border:1px solid var(--border);
  color:var(--ink2);
  font-family:'Cormorant Garamond',serif;
  font-size:14px;font-style:italic;
  padding:10px 12px;outline:none;cursor:pointer;
}
.theory-select:focus{border-color:var(--gold)}
.theory-select option{background:var(--paper2);color:var(--ink2)}

/* Progress */
.progress-item{
  display:flex;align-items:center;gap:10px;margin-bottom:10px;
}
.prog-icon{font-size:14px}
.prog-text{font-size:12px;color:var(--ink3);flex:1;font-style:italic}
.prog-check{font-size:13px;color:var(--gold)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   MODAL
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#modal-overlay{
  display:none;position:fixed;inset:0;z-index:150;
  background:rgba(0,0,0,.88);backdrop-filter:blur(6px);
  align-items:center;justify-content:center;padding:20px;
}
#modal-overlay.open{display:flex;animation:fadeIn .2s ease}
@keyframes fadeIn{from{opacity:0;transform:scale(.97)}to{opacity:1;transform:none}}

#modal-box{
  background:var(--paper);
  border:1px solid var(--border);
  max-width:720px;width:100%;
  max-height:90vh;
  overflow-y:auto;
  position:relative;
  box-shadow:0 24px 100px rgba(0,0,0,.9);
}

.modal-header{
  padding:24px 28px 20px;
  border-bottom:1px solid var(--border2);
  display:flex;align-items:flex-start;
  justify-content:space-between;gap:16px;
  position:sticky;top:0;background:var(--paper);z-index:1;
}
.modal-title-text{
  font-family:'Cinzel',serif;
  font-size:22px;letter-spacing:3px;color:var(--ink);
}
.modal-subtitle-text{font-size:13px;font-style:italic;color:var(--ink3);margin-top:4px}
.modal-close{
  font-family:'Cinzel',serif;font-size:16px;
  color:var(--ink3);background:none;border:none;cursor:pointer;
  padding:4px 8px;transition:color .2s;flex-shrink:0;
}
.modal-close:hover{color:var(--red3)}

.modal-body{padding:28px}

/* Room scene */
.room-scene-text{
  font-size:15px;line-height:2.1;color:var(--ink2);
  font-style:italic;margin-bottom:24px;
  padding-left:16px;border-left:2px solid var(--gold);
}
.room-atmosphere{
  font-size:13px;color:var(--ink3);font-style:italic;
  margin-bottom:20px;line-height:1.8;
}

.clue-card{
  display:flex;align-items:flex-start;gap:14px;
  padding:18px;
  border:1px solid rgba(196,144,48,.3);
  background:rgba(196,144,48,.05);
  margin-bottom:12px;
  animation:clueReveal .5s ease;
}
.clue-card.already-found{
  border-color:var(--border2);background:transparent;opacity:.6;
}
@keyframes clueReveal{from{opacity:0;transform:translateX(-8px)}to{opacity:1;transform:none}}
.clue-card-icon{font-size:26px;flex-shrink:0;line-height:1}
.clue-card-name{
  font-family:'Cinzel',serif;font-size:12px;letter-spacing:1px;
  color:var(--gold2);margin-bottom:5px;
}
.clue-card-text{font-size:13px;font-style:italic;color:var(--ink2);line-height:1.8}
.clue-card-suspects{
  margin-top:8px;font-size:10px;letter-spacing:2px;
  color:var(--ink4);font-family:'Cinzel',serif;
  text-transform:uppercase;
}

/* Interrogation */
.interro-portrait{
  display:flex;align-items:center;gap:16px;
  padding:16px 20px;
  border:1px solid var(--border2);
  background:var(--paper2);
  margin-bottom:20px;
}
.interro-emoji{font-size:40px;line-height:1}
.interro-name{
  font-family:'Cinzel',serif;font-size:18px;letter-spacing:3px;
  color:var(--ink);margin-bottom:4px;
}
.interro-role{font-size:13px;font-style:italic;color:var(--ink3);margin-bottom:4px}
.interro-alibi{
  font-family:'Cinzel',serif;font-size:9px;letter-spacing:2px;
  color:var(--ink4);text-transform:uppercase;
}

.interro-intro{
  font-size:14px;font-style:italic;color:var(--ink2);
  line-height:2;margin-bottom:24px;
  padding:18px;border-left:3px solid var(--gold);
  background:rgba(196,144,48,.04);
}

.question-list{display:flex;flex-direction:column;gap:8px;margin-bottom:20px}

.q-btn{
  display:flex;align-items:flex-start;gap:12px;
  padding:14px 18px;
  background:var(--paper2);
  border:1px solid var(--border2);
  color:var(--ink2);
  font-family:'Cormorant Garamond',serif;
  font-style:italic;font-size:14px;
  cursor:pointer;transition:all .25s;
  text-align:left;width:100%;
}
.q-btn:hover:not(.asked){
  background:var(--paper3);
  border-color:rgba(196,144,48,.4);
  color:var(--ink);
}
.q-btn.asked{
  opacity:.5;cursor:default;
  border-color:var(--border2);
  background:transparent;
}
.q-btn.key-question{border-color:rgba(196,144,48,.35);color:var(--ink)}
.q-btn.key-question:not(.asked)::before{
  content:'â˜…';
  color:var(--gold);flex-shrink:0;font-style:normal;
}
.q-num{
  font-family:'Cinzel',serif;font-size:10px;letter-spacing:2px;
  color:var(--ink3);flex-shrink:0;margin-top:2px;
}

.answer-card{
  border-left:3px solid var(--char-color,var(--gold));
  padding:16px 20px;
  background:rgba(255,255,255,.02);
  margin-bottom:12px;
  animation:answerIn .4s ease;
}
@keyframes answerIn{from{opacity:0;transform:translateY(6px)}to{opacity:1;transform:none}}

.answer-speaker{
  font-family:'Cinzel',serif;font-size:10px;letter-spacing:3px;
  margin-bottom:8px;text-transform:uppercase;
}
.answer-text{font-size:14px;color:var(--ink2);line-height:2;font-style:italic}
.answer-text em{color:var(--ink3)}

.answer-clue{
  margin-top:12px;padding:10px 14px;
  background:rgba(196,144,48,.08);border:1px solid rgba(196,144,48,.25);
  font-size:12px;color:var(--gold2);display:flex;align-items:flex-start;gap:8px;
  line-height:1.6;
}
.answer-lie{
  margin-top:12px;padding:10px 14px;
  background:rgba(192,40,40,.08);border:1px solid rgba(192,40,40,.3);
  font-size:12px;color:#f09090;display:flex;align-items:flex-start;gap:8px;
  line-height:1.6;
}
.answer-newinfo{
  margin-top:12px;padding:10px 14px;
  background:rgba(128,30,200,.08);border:1px solid rgba(128,30,200,.3);
  font-size:12px;color:#d0a0ff;display:flex;align-items:flex-start;gap:8px;
  line-height:1.6;
}

/* Re-interrogation indicator */
.reinquiry-note{
  font-family:'Cinzel',serif;font-size:9px;letter-spacing:3px;
  color:var(--ink4);text-align:center;padding:12px;
  border:1px dashed var(--border2);margin-bottom:16px;
}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ACCUSATION SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#accusation-screen{
  display:none;
  position:fixed;inset:0;z-index:200;
  background:var(--bg);
  overflow-y:auto;padding:40px 20px;
}

.acc-wrap{max-width:700px;margin:0 auto}

.acc-header{text-align:center;margin-bottom:48px}
.acc-title{
  font-family:'Cinzel Decorative',serif;
  font-size:clamp(28px,7vw,54px);font-weight:700;
  letter-spacing:6px;color:var(--red3);
  margin-bottom:10px;
}
.acc-subtitle{
  font-family:'Cormorant Garamond',serif;
  font-size:16px;font-style:italic;color:var(--ink3);
}

.acc-divider{
  width:100%;height:1px;
  background:linear-gradient(to right,transparent,rgba(192,40,40,.5),transparent);
  margin:28px 0;
}

.acc-field{border:1px solid var(--border);background:var(--paper);margin-bottom:16px}
.acc-field-label{
  padding:12px 20px;
  background:var(--paper2);
  border-bottom:1px solid var(--border2);
  font-family:'Cinzel',serif;
  font-size:9px;letter-spacing:5px;color:var(--gold);
  text-transform:uppercase;
}
.acc-options{display:flex;flex-wrap:wrap;gap:0}
.acc-option{
  flex:1;min-width:120px;
  padding:14px 18px;
  background:transparent;
  border:none;
  border-right:1px solid var(--border2);
  border-bottom:1px solid var(--border2);
  color:var(--ink2);
  font-family:'Cormorant Garamond',serif;
  font-style:italic;font-size:14px;
  cursor:pointer;transition:all .2s;text-align:left;
}
.acc-option:hover{background:var(--paper2);color:var(--ink)}
.acc-option.selected{
  background:rgba(196,144,48,.1);
  color:var(--gold2);
  border-color:rgba(196,144,48,.35);
}

.acc-summary{
  border:1px solid var(--border2);
  padding:20px 24px;
  margin:24px 0;
  background:var(--paper2);
  font-size:14px;color:var(--ink3);
  line-height:2;font-style:italic;
}
.acc-summary strong{color:var(--ink);font-style:normal}

.acc-note{
  font-size:13px;font-style:italic;color:var(--ink3);
  line-height:1.8;padding:16px 20px;
  background:rgba(0,0,0,.2);border:1px solid var(--border2);
  margin-bottom:24px;
}

.btn-confirm{
  font-family:'Cinzel',serif;
  font-size:13px;font-weight:700;
  letter-spacing:6px;
  padding:22px;width:100%;
  background:var(--red);border:1px solid var(--red2);
  color:#f0c0c0;cursor:pointer;transition:all .3s;
  text-transform:uppercase;
}
.btn-confirm:hover{background:var(--red2)}
.btn-confirm:disabled{opacity:.35;pointer-events:none}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   ENDING SCREEN
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#ending-screen{
  display:none;position:fixed;inset:0;z-index:210;
  background:var(--bg);overflow-y:auto;
  padding:60px 20px;
}

.ending-wrap{max-width:760px;margin:0 auto}

.ending-stamp{
  text-align:center;
  font-family:'Cinzel Decorative',serif;
  font-size:clamp(30px,7vw,60px);
  font-weight:700;line-height:1;
  margin-bottom:40px;
}
.ending-stamp.correct{color:#50d890;text-shadow:0 0 50px rgba(80,216,144,.35)}
.ending-stamp.partial{color:var(--gold2);text-shadow:0 0 50px rgba(224,176,80,.3)}
.ending-stamp.wrong{color:var(--red3);text-shadow:0 0 50px rgba(220,64,64,.35)}

.ending-paper{
  border:2px solid var(--border);
  background:var(--paper);
  padding:44px;
  position:relative;
  margin-bottom:32px;
}
.ending-paper::before{
  content:'â€” EDIÃ‡ÃƒO ESPECIAL â€” CASO ENCERRADO â€”';
  position:absolute;top:-11px;left:50%;
  transform:translateX(-50%);
  background:var(--paper);padding:0 18px;
  font-family:'Cinzel',serif;font-size:8px;letter-spacing:5px;color:var(--gold);
  white-space:nowrap;
}

.ending-headline{
  font-family:'Cinzel',serif;
  font-size:clamp(20px,4vw,36px);
  font-weight:700;letter-spacing:2px;
  color:var(--ink);line-height:1.2;
  margin-bottom:16px;text-align:center;
  padding-bottom:20px;
  border-bottom:1px solid var(--border2);
}

.ending-story{
  font-size:clamp(14px,2vw,16px);
  line-height:2.2;color:var(--ink2);
  margin-bottom:20px;
}
.ending-story p{margin-bottom:16px}
.ending-story strong{color:var(--ink)}
.ending-story em{color:var(--gold2);font-style:normal}

.ending-reveal{
  border-top:1px solid var(--border2);
  padding-top:24px;margin-top:8px;
}
.ending-reveal-title{
  font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;
  color:var(--gold);margin-bottom:14px;text-transform:uppercase;
}

.truth-grid{
  display:grid;grid-template-columns:1fr 1fr 1fr;gap:12px;
  margin-bottom:24px;
}
.truth-item{
  border:1px solid var(--border2);padding:14px;
  background:var(--paper2);text-align:center;
}
.truth-label{
  font-family:'Cinzel',serif;font-size:8px;letter-spacing:3px;
  color:var(--ink3);margin-bottom:8px;text-transform:uppercase;
}
.truth-val{
  font-family:'Cinzel',serif;font-size:13px;
  color:var(--ink);letter-spacing:1px;
}

.score-grid{
  display:grid;grid-template-columns:repeat(4,1fr);gap:12px;
  margin:28px 0;
}
.score-item{
  border:1px solid var(--border);padding:16px;text-align:center;
  background:var(--paper2);
}
.score-val{
  font-family:'Cinzel Decorative',serif;
  font-size:26px;color:var(--gold2);
}
.score-lbl{font-size:8px;letter-spacing:3px;color:var(--ink3);margin-top:4px;text-transform:uppercase}

.rank-display{
  text-align:center;margin:20px 0;
  padding:16px;border:1px solid rgba(196,144,48,.3);
  background:rgba(196,144,48,.05);
}
.rank-title{
  font-family:'Cinzel Decorative',serif;
  font-size:clamp(18px,4vw,28px);color:var(--gold3);
}
.rank-label{font-size:11px;letter-spacing:4px;color:var(--ink3);margin-top:6px;font-family:'Cinzel',serif}

.btn-restart{
  font-family:'Cinzel',serif;
  font-size:11px;letter-spacing:5px;
  padding:18px 48px;
  background:transparent;border:1px solid var(--border);
  color:var(--ink2);cursor:pointer;transition:all .3s;
  display:block;margin:0 auto;text-transform:uppercase;
}
.btn-restart:hover{border-color:var(--gold);color:var(--gold2)}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   TOAST
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
#toast{
  position:fixed;bottom:28px;right:28px;z-index:500;
  background:var(--paper);border:1px solid var(--gold);
  padding:14px 20px;max-width:320px;
  display:none;font-size:13px;font-style:italic;color:var(--ink2);
  box-shadow:0 8px 40px rgba(0,0,0,.7);
  animation:toastIn .3s ease;
}
@keyframes toastIn{from{opacity:0;transform:translateY(8px)}to{opacity:1;transform:none}}
.toast-icon{margin-right:8px}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   SPECIAL: REVELATION UNLOCK
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.revelation-box{
  border:1px solid var(--purple2);
  background:rgba(128,30,200,.08);
  padding:18px 20px;
  margin-bottom:20px;
  animation:revelationPulse 3s ease-in-out infinite;
}
@keyframes revelationPulse{0%,100%{border-color:rgba(128,30,200,.4)}50%{border-color:rgba(128,30,200,.8)}}
.revelation-title{
  font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;
  color:var(--purple2);margin-bottom:8px;text-transform:uppercase;
}
.revelation-text{font-size:13px;color:#d0b0f0;font-style:italic;line-height:1.8}

/* â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
   CONFRONTATION modal
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â• */
.confrontation-box{
  border:1px solid var(--red2);
  background:rgba(192,40,40,.07);
  padding:18px;margin-bottom:16px;
}
.conf-title{
  font-family:'Cinzel',serif;font-size:10px;letter-spacing:4px;
  color:var(--red3);margin-bottom:8px;text-transform:uppercase;
}
.conf-text{font-size:13px;color:#f0b0b0;font-style:italic;line-height:1.8}

/* Scrollbar */
::-webkit-scrollbar{width:4px}
::-webkit-scrollbar-track{background:var(--paper)}
::-webkit-scrollbar-thumb{background:rgba(196,144,48,.2);border-radius:2px}

/* Responsive */
@media(max-width:960px){
  #game-main{grid-template-columns:260px 1fr}
  #panel-right{display:none}
}
@media(max-width:680px){
  #game-main{grid-template-columns:1fr}
  #panel-left{position:static;max-height:none}
}
</style>
</head>
<body>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• SPLASH â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="splash">
  <div class="splash-wrap">
    <div class="splash-frame-outer">
      <div class="splash-frame-inner">
        <div class="sp-corner tl"></div>
        <div class="sp-corner tr"></div>
        <div class="sp-corner bl"></div>
        <div class="sp-corner br"></div>

        <div class="sp-eyebrow">InvestigaÃ§Ã£o Â· DeduÃ§Ã£o Â· RevelaÃ§Ã£o</div>
        <div class="sp-title-top">VILLA</div>
        <div class="sp-title-bottom">OBSCURA</div>
        <div class="sp-subtitle">â€” A HeranÃ§a Maldita â€”</div>

        <div class="sp-divider">
          <div class="sp-divider-icon">âœ¦ MCMXCV âœ¦</div>
        </div>

        <div class="sp-premise">
          O excÃªntrico <strong>Duarte Vasconcelos</strong> foi encontrado morto em sua villa no interior.<br>
          O testamento â€” que deveria ser lido naquela noite â€” <strong>desapareceu</strong>.<br>
          Sete herdeiros sob o mesmo teto. Um segredo de dÃ©cadas.<br>
          AlguÃ©m tem muito a perder. <strong>Descubra quem roubou o documento antes que a verdade seja enterrada com ele.</strong>
        </div>

        <div class="sp-cast">
          <span class="sp-cast-tag">POLLYANA</span>
          <span class="sp-cast-tag">CARLUZ</span>
          <span class="sp-cast-tag">EROS</span>
          <span class="sp-cast-tag">STEPHANY</span>
          <span class="sp-cast-tag">MARY</span>
          <span class="sp-cast-tag">MEL</span>
          <span class="sp-cast-tag">JOY</span>
          <span class="sp-cast-tag">ELLIE</span>
        </div>

        <div class="sp-mechanics">
          <div class="sp-mech">
            <div class="sp-mech-icon">ğŸ”</div>
            <div class="sp-mech-title">Pistas em Camadas</div>
            <div class="sp-mech-text">Cada cÃ´modo revela pistas que se conectam â€” algumas sÃ³ fazem sentido depois de ouvir testemunhos</div>
          </div>
          <div class="sp-mech">
            <div class="sp-mech-icon">ğŸ’¬</div>
            <div class="sp-mech-title">InterrogatÃ³rios Vivos</div>
            <div class="sp-mech-text">Pressione com evidÃªncias, detecte mentiras e desbloqueie revelaÃ§Ãµes ao confrontar suspeitos</div>
          </div>
          <div class="sp-mech">
            <div class="sp-mech-icon">ğŸ•¸ï¸</div>
            <div class="sp-mech-title">Teia de ConexÃµes</div>
            <div class="sp-mech-text">Relacionamentos e segredos cruzados. Quem tem alibi real? Quem cobre pra quem?</div>
          </div>
          <div class="sp-mech">
            <div class="sp-mech-icon">â³</div>
            <div class="sp-mech-title">Sem PressÃ£o de Tempo</div>
            <div class="sp-mech-text">Tome o tempo que precisar. A investigaÃ§Ã£o perfeita exige paciÃªncia</div>
          </div>
        </div>

        <button class="sp-btn" onclick="startGame()"><span>â–¶ INICIAR INVESTIGAÃ‡ÃƒO</span></button>
        <div class="sp-warn">FICÃ‡ÃƒO INTERATIVA Â· PERSONAGENS FICTÃCIOS Â· +16</div>
      </div>
    </div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• GAME â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="game">

  <div id="topbar">
    <div class="tb-logo">VILLA OBSCURA</div>
    <div class="tb-center">
      <div class="tb-stat">
        <div class="tb-stat-val" id="stat-pistas">0</div>
        <div class="tb-stat-lbl">Pistas</div>
      </div>
      <div class="tb-stat">
        <div class="tb-stat-val" id="stat-interr">0/8</div>
        <div class="tb-stat-lbl">InterrogaÃ§Ãµes</div>
      </div>
      <div class="tb-stat">
        <div class="tb-stat-val" id="stat-mentiras">0</div>
        <div class="tb-stat-lbl">Mentiras</div>
      </div>
      <div class="tb-stat">
        <div class="tb-stat-val" id="stat-certeza">â€“</div>
        <div class="tb-stat-lbl">+ Suspeito</div>
      </div>
    </div>
    <div class="tb-right">
      <div class="tb-phase" id="tb-phase">FASE I â€” CHEGADA</div>
      <button class="btn-accuse" id="btn-accuse" onclick="openAccusation()">âš– ACUSAR</button>
    </div>
  </div>

  <div id="game-main">

    <!-- LEFT -->
    <div id="panel-left">
      <div class="panel-section">
        <div class="p-label">EvidÃªncias Coletadas</div>
        <div id="evidence-list">
          <div style="font-size:12px;font-style:italic;color:var(--ink4)">Nenhuma evidÃªncia ainda.<br>Investigue os cÃ´modos.</div>
        </div>
      </div>

      <div class="panel-section">
        <div class="p-label">Status dos Suspeitos</div>
        <div id="alibi-list"></div>
      </div>

      <div class="panel-section">
        <div class="p-label">Linha do Tempo</div>
        <div id="timeline-list">
          <div style="font-size:11px;font-style:italic;color:var(--ink4)">ConstruÃ­da Ã  medida que vocÃª investiga...</div>
        </div>
      </div>

      <div class="panel-section">
        <div class="p-label">Suas AnotaÃ§Ãµes</div>
        <textarea id="notes-area" placeholder="Anote suas teorias...&#10;&#10;Quem tinha motivo? Quem mentiu?&#10;Quais pistas se conectam?"></textarea>
      </div>
    </div>

    <!-- CENTER -->
    <div id="panel-center">
      <div class="center-header">
        <div class="ch-kicker">Villa Obscura Â· Caso NÂº 001 Â· DossiÃª Restrito</div>
        <div class="ch-headline">O TESTAMENTO<br>DESAPARECEU</div>
        <div class="ch-sub">Sete herdeiros, uma noite, um documento que vale uma fortuna â€”<br>e alguÃ©m entre eles nÃ£o quer que a verdade venha Ã  tona</div>
        <div class="ch-meta">
          <span>Investigador: VocÃª</span>
          <span>Local: Villa Vasconcelos</span>
          <span>SituaÃ§Ã£o: Ativa</span>
        </div>
      </div>

      <div class="report-box">
        <div class="report-text">
          O patriarca <strong>Duarte Vasconcelos</strong>, 74 anos, foi encontrado morto em seu escritÃ³rio Ã s 7h da manhÃ£. Causa mortis: parada cardÃ­aca â€” aparentemente natural. Mas o testamento, que ele havia anunciado que leria Ã quelas oito pessoas naquela mesma noite, <strong>nÃ£o estava em lugar algum</strong>.<br><br>
          O cofre estava vazio. A janela, fechada por dentro. Os herdeiros estavam na villa â€” e um deles, ao que tudo indica, sabia o que estava escrito no documento. Sabia, e nÃ£o queria que os outros soubessem. <strong>Encontre o testamento. Descubra quem o roubou â€” e por quÃª.</strong>
        </div>
      </div>

      <div class="phase-banner" id="phase-banner">
        <div class="phase-banner-icon">ğŸ›ï¸</div>
        <div class="phase-banner-body">
          <div class="phase-banner-title">Fase I â€” A Chegada</div>
          <div class="phase-banner-text">Comece investigando os cÃ´modos da villa e interrogando os herdeiros. As primeiras pistas revelarÃ£o quem tinha acesso ao cofre.</div>
        </div>
      </div>

      <div class="sec-title">Investigar CÃ´modos</div>
      <div class="rooms-grid" id="rooms-grid"></div>

      <div class="sec-title">Interrogar Suspeitos</div>
      <div class="chars-grid" id="chars-grid"></div>
    </div>

    <!-- RIGHT -->
    <div id="panel-right">
      <div class="ded-header">Quadro de DeduÃ§Ã£o</div>

      <div id="suspect-meters"></div>

      <div class="theory-box">
        <div class="theory-section">
          <div class="theory-label">Culpado â€” Sua Teoria</div>
          <select class="theory-select" id="theory-culpado" onchange="updateProgress()">
            <option value="">â€” selecione â€”</option>
            <option>Pollyana</option><option>Carluz</option>
            <option>Eros</option><option>Stephany</option>
            <option>Mary</option><option>Mel</option>
            <option>Joy</option><option>Ellie</option>
          </select>
        </div>
        <div class="theory-section">
          <div class="theory-label">Motivo â€” Sua Teoria</div>
          <select class="theory-select" id="theory-motivo" onchange="updateProgress()">
            <option value="">â€” selecione â€”</option>
            <option value="heranca">HeranÃ§a em risco</option>
            <option value="segredo">Segredo comprometedor</option>
            <option value="vinganca">VinganÃ§a familiar</option>
            <option value="protecao">Proteger outro herdeiro</option>
            <option value="divida">DÃ­vida desesperada</option>
          </select>
        </div>
        <div class="theory-section">
          <div class="theory-label">MÃ©todo â€” Sua Teoria</div>
          <select class="theory-select" id="theory-metodo" onchange="updateProgress()">
            <option value="">â€” selecione â€”</option>
            <option value="combinacao">CÃ³digo do cofre obtido antes</option>
            <option value="chave">Chave-mestra duplicada</option>
            <option value="cumplicidade">Cumplicidade â€” dois envolvidos</option>
            <option value="acidente">Encontrou acidentalmente</option>
          </select>
        </div>
      </div>

      <div class="panel-section">
        <div class="p-label">ConexÃµes Entre Personagens</div>
        <div id="connections-list">
          <div style="font-size:11px;font-style:italic;color:var(--ink4)">Descobertas ao interrogar...</div>
        </div>
      </div>

      <div class="panel-section">
        <div class="p-label">Progresso da InvestigaÃ§Ã£o</div>
        <div id="progress-list"></div>
      </div>
    </div>

  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• MODAL â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="modal-overlay" onclick="handleOverlayClick(event)">
  <div id="modal-box">
    <div class="modal-header">
      <div>
        <div class="modal-title-text" id="modal-title"></div>
        <div class="modal-subtitle-text" id="modal-subtitle"></div>
      </div>
      <button class="modal-close" onclick="closeModal()">âœ•</button>
    </div>
    <div class="modal-body" id="modal-body"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• ACCUSATION â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="accusation-screen">
  <div class="acc-wrap">
    <div class="acc-header">
      <div class="acc-title">AcusaÃ§Ã£o Formal</div>
      <div class="acc-subtitle">VocÃª reuniu as evidÃªncias. Chegou a hora da verdade.<br>Escolha com sabedoria â€” nÃ£o hÃ¡ como voltar.</div>
    </div>
    <div id="accusation-form"></div>
  </div>
</div>

<!-- â•â•â•â•â•â•â•â•â•â•â•â• ENDING â•â•â•â•â•â•â•â•â•â•â•â• -->
<div id="ending-screen">
  <div class="ending-wrap" id="ending-wrap"></div>
</div>

<!-- TOAST -->
<div id="toast"><span class="toast-icon">ğŸ”</span><span id="toast-text"></span></div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

const CHARACTERS = {
  Pollyana: {
    color:'#c84820',
    emoji:'ğŸŒ»',
    role:'Sobrinha favorita â€” herdeira principal no testamento anterior',
    alibi:'Afirma ter ficado no quarto lendo',
    desc:'CalmÃ­ssima para a situaÃ§Ã£o. Conhecia o velho melhor que todos.',
  },
  Carluz: {
    color:'#d49010',
    emoji:'âš¡',
    role:'Sobrinho â€” excluÃ­do do testamento apÃ³s briga com Duarte',
    alibi:'Diz ter ficado na sala com Eros',
    desc:'Nervoso. Tem muito a perder â€” ou jÃ¡ perdeu tudo.',
  },
  Eros: {
    color:'#9030c0',
    emoji:'ğŸ”®',
    role:'Primo distante â€” recÃ©m-incluÃ­do no testamento por surpresa',
    alibi:'Diz ter ficado com Carluz atÃ© tarde',
    desc:'Elegante demais para a situaÃ§Ã£o. Parece saber mais do que fala.',
  },
  Stephany: {
    color:'#2070c0',
    emoji:'ğŸ“',
    role:'Advogada â€” redatora do prÃ³prio testamento desaparecido',
    alibi:'Afirma ter dormido cedo apÃ³s a janta',
    desc:'Profissional. Mede cada palavra. SÃ³ ela conhecia o conteÃºdo completo.',
  },
  Mary: {
    color:'#209060',
    emoji:'ğŸŒ¿',
    role:'Assistente pessoal de Duarte hÃ¡ 11 anos',
    alibi:'Diz ter ficado na cozinha atÃ© tarde',
    desc:'A mais abalada pela morte. Ou representa isso muito bem.',
  },
  Mel: {
    color:'#c02858',
    emoji:'ğŸŒ¸',
    role:'Neta ilegÃ­tima â€” reconhecida formalmente sÃ³ nesse testamento',
    alibi:'Diz ter saÃ­do para o jardim Ã  meia-noite',
    desc:'A revelaÃ§Ã£o da noite. Sua existÃªncia muda tudo para os outros.',
  },
  Joy: {
    color:'#e05010',
    emoji:'ğŸ·',
    role:'Filha mais velha â€” esperava herdar tudo',
    alibi:'Diz ter ficado no terraÃ§o bebendo',
    desc:'Furiosa. NÃ£o esconde que considera o testamento uma injustiÃ§a.',
  },
  Ellie: {
    color:'#308090',
    emoji:'ğŸŒŠ',
    role:'Filha mais nova â€” sempre em segundo plano',
    alibi:'Afirma ter dormido logo apÃ³s o jantar',
    desc:'Quieta. Observa tudo. DifÃ­cil ler o que pensa.',
  },
};

const ROOMS = [
  {
    id:'escritorio',
    name:'EscritÃ³rio de Duarte',
    icon:'ğŸ“œ',
    hint:'Onde o corpo foi encontrado',
    color:'#c49030',
    desc:'O escritÃ³rio cheira a tabaco e papel antigo. O cofre embutido na parede estÃ¡ aberto â€” vazio. A escrivaninha tem gavetas levemente fora do lugar. Uma luz estava acesa quando descobriram o corpo.',
    atmosphere:'O centro de tudo. Cada objeto aqui pode ser a chave.',
    clues:[
      {
        id:'c_cofre',
        icon:'ğŸ”’',
        name:'Cofre Vazio â€” ArranhÃµes Frescos',
        text:'O cofre nÃ£o foi forÃ§ado â€” foi aberto com a combinaÃ§Ã£o. Mas hÃ¡ arranhÃµes novos ao redor do disco: alguÃ©m girou nervosamente, talvez Ã s cegas. Quem sabia a combinaÃ§Ã£o?',
        suspects:['Stephany','Joy','Pollyana'],
        timelineEntry:{time:'23h?',text:'<strong>AlguÃ©m</strong> abriu o cofre com a combinaÃ§Ã£o correta â€” mas de forma agitada.'},
      },
      {
        id:'c_copo',
        icon:'ğŸ¥ƒ',
        name:'Copo de Bourbon com Batom',
        text:'Sobre a mesa: um copo com restos de bourbon e uma marca de batom cor de rosa-velho. Duarte nÃ£o usava batom. AlguÃ©m esteve aqui com ele antes de morrer.',
        suspects:['Joy','Pollyana','Mel'],
        timelineEntry:{time:'21h',text:'Uma mulher tomou bourbon com <strong>Duarte</strong> no escritÃ³rio antes da morte.'},
      },
      {
        id:'c_carta',
        icon:'ğŸ“„',
        name:'Rascunho de Carta Rasgado',
        text:'Na lixeira: um rascunho rasgado em pedaÃ§os. ApÃ³s montagem, lÃª-se: "...se a heranÃ§a for dividida como planejo, certifique-se de que [rasgado] nÃ£o descubra antes que eu possa explicar pessoalmente. A reaÃ§Ã£o pode ser [rasgado]..."',
        suspects:['Stephany','Pollyana','Joy'],
        timelineEntry:{time:'Dias antes',text:'<strong>Duarte</strong> estava preocupado com a reaÃ§Ã£o de alguÃ©m ao testamento.'},
      },
    ]
  },
  {
    id:'sala_jantar',
    name:'Sala de Jantar',
    icon:'ğŸ•¯ï¸',
    hint:'Ãšltima refeiÃ§Ã£o juntos',
    color:'#8a3010',
    desc:'A mesa ainda tem as louÃ§as do jantar de ontem. Seis taÃ§as de vinho â€” mas eram oito Ã  mesa. Duas pessoas nÃ£o beberam. As cadeiras estÃ£o levemente deslocadas, como de uma conversa acalorada que terminou mal.',
    atmosphere:'O palco do Ãºltimo encontro. TensÃµes antigas vieram Ã  tona aqui.',
    clues:[
      {
        id:'c_tacas',
        icon:'ğŸ·',
        name:'Seis TaÃ§as â€” Duas AusÃªncias',
        text:'Oito pessoas no jantar, apenas seis taÃ§as com vinho. AlguÃ©m sÃ³brio â€” ou dois. Quem evitou o Ã¡lcool naquela noite? E por quÃª?',
        suspects:['Ellie','Stephany'],
        timelineEntry:{time:'20h',text:'Duas pessoas ficaram sÃ³brias durante o jantar â€” possivelmente planejando algo.'},
      },
      {
        id:'c_bilhete',
        icon:'ğŸ“',
        name:'Bilhete Dobrado Sob Prato',
        text:'Escondido sob um dos pratos: um bilhete escrito Ã  mÃ£o. "Esta noite. Espera que eu saia. Depois vai sozinha." â€” A letra Ã© pequena, precipitada. Nenhuma assinatura. Para quem?',
        suspects:['Eros','Carluz','Mel'],
        timelineEntry:{time:'20h',text:'Um bilhete secreto foi passado durante o jantar â€” uma instruÃ§Ã£o para alguÃ©m agir sozinho.'},
      },
    ]
  },
  {
    id:'biblioteca',
    name:'Biblioteca',
    icon:'ğŸ“š',
    hint:'Arquivo e memÃ³ria',
    color:'#503080',
    desc:'Estantes do chÃ£o ao teto. Cheira a livros velhos e segredos guardados. Um livro em especial â€” "Direito SucessÃ³rio Brasileiro" â€” estÃ¡ com marcadores em cinco pÃ¡ginas diferentes. AlguÃ©m pesquisou a fundo.',
    atmosphere:'O conhecimento Ã© poder. AlguÃ©m usou este lugar para se preparar.',
    clues:[
      {
        id:'c_livro',
        icon:'âš–ï¸',
        name:'Livro de Direito Marcado',
        text:'"Direito SucessÃ³rio Brasileiro" com marcaÃ§Ãµes a lÃ¡pis em seÃ§Ãµes sobre heranÃ§a contestada, herdeiros ilegÃ­timos e prazo de impugnaÃ§Ã£o de testamento. AlguÃ©m estudou as formas de contestar o documento.',
        suspects:['Joy','Carluz','Stephany'],
        timelineEntry:{time:'Dias antes',text:'AlguÃ©m pesquisou formas de <strong>contestar um testamento</strong> na biblioteca.'},
      },
      {
        id:'c_diario',
        icon:'ğŸ““',
        name:'DiÃ¡rio de Duarte â€” Ãšltima Entrada',
        text:'Um diÃ¡rio escondido atrÃ¡s dos volumes de enciclopÃ©dia. Ãšltima entrada, dois dias atrÃ¡s: "Ela finalmente sabe. ReaÃ§Ã£o melhor do que esperava. Mas os outros... preciso estar presente quando descobrirem. Sem Stephany para conter, pode ser catastrÃ³fico."',
        suspects:['Mel','Stephany','Joy'],
        timelineEntry:{time:'2 dias antes',text:'<strong>Duarte</strong> revelou um segredo para alguÃ©m â€” e temia a reaÃ§Ã£o dos outros herdeiros.'},
      },
      {
        id:'c_chave',
        icon:'ğŸ—ï¸',
        name:'ImpressÃ£o da Chave do Cofre',
        text:'Em uma caixa de pÃ³ de impressÃ£o na gaveta da escrivaninha de estudo: uma impressÃ£o parcial de chave. A chave do cofre foi copiada. NÃ£o hÃ¡ como saber quando â€” mas a impressÃ£o ainda estÃ¡ fresca.',
        suspects:['Eros','Pollyana','Mary'],
        timelineEntry:{time:'Recente',text:'A chave do cofre foi copiada ou pelo menos <strong>tentada reproduzir</strong> na biblioteca.'},
      },
    ]
  },
  {
    id:'terraÃ§o',
    name:'TerraÃ§o',
    icon:'ğŸŒ™',
    hint:'Vista para o jardim â€” e para o escritÃ³rio',
    color:'#103060',
    desc:'Do terraÃ§o se vÃª a janela iluminada do escritÃ³rio de Duarte. AlguÃ©m aqui poderia observar quem entrava e saÃ­a. Uma cadeira de vime estÃ¡ virada. Uma garrafa de vinho â€” aberta, pela metade â€” com um Ãºnico copo.',
    atmosphere:'O observatÃ³rio involuntÃ¡rio. Quem estava aqui viu mais do que imagina.',
    clues:[
      {
        id:'c_cigarro',
        icon:'ğŸš¬',
        name:'Bitucas de Cigarro â€” TrÃªs',
        text:'TrÃªs bitucas de cigarro na beira do terraÃ§o. SÃ³ uma pessoa no grupo fuma: Joy. Ela ficou aqui tempo suficiente para fumar trÃªs cigarros. O terraÃ§o tem visÃ£o direta para a janela do escritÃ³rio.',
        suspects:['Joy'],
        timelineEntry:{time:'23hâ€“1h',text:'<strong>Joy</strong> ficou no terraÃ§o por tempo prolongado â€” com visÃ£o direta ao escritÃ³rio.'},
      },
      {
        id:'c_observacao',
        icon:'ğŸ‘ï¸',
        name:'Marca no Parapeito',
        text:'Uma marca de cotovelo na poeira do parapeito â€” alguÃ©m se debruÃ§ou aqui por longo tempo, olhando para baixo. A posiÃ§Ã£o exata dÃ¡ linha de visÃ£o para a porta do escritÃ³rio de Duarte.',
        suspects:['Joy','Ellie'],
        timelineEntry:{time:'Noite',text:'AlguÃ©m observou a entrada do escritÃ³rio do terraÃ§o durante a noite.'},
      },
    ]
  },
  {
    id:'quarto_duarte',
    name:'Quarto de Duarte',
    icon:'ğŸ›ï¸',
    hint:'Dormiu aqui pela Ãºltima vez',
    color:'#604010',
    desc:'Quarto ordenado â€” Duarte era metÃ³dico. Mas o criado-mudo estÃ¡ com a gaveta levemente aberta. Um retrato da famÃ­lia foi virado com a face para baixo. E sobre o travesseiro: uma Ãºnica rosa branca.',
    atmosphere:'A intimidade de um homem que sabia mais do que revelava.',
    clues:[
      {
        id:'c_retrato',
        icon:'ğŸ–¼ï¸',
        name:'Retrato Virado',
        text:'Uma foto de famÃ­lia â€” Duarte jovem com esposa e filhas Joy e Ellie â€” estÃ¡ com a face para baixo. Parece ter sido virado recentemente. TambÃ©m hÃ¡ uma foto oculta atrÃ¡s: Duarte com uma mulher jovem que nÃ£o Ã© reconhecÃ­vel. No verso: "Minha LÃ©a. 1993."',
        suspects:['Joy','Ellie','Mel'],
        timelineEntry:{time:'Passado',text:'<strong>Duarte</strong> tinha uma filha oculta â€” cujo retrato guardava secretamente.'},
      },
      {
        id:'c_medicamento',
        icon:'ğŸ’Š',
        name:'Medicamentos Manipulados',
        text:'Na gaveta do criado-mudo: uma caixa de remÃ©dios cardÃ­acos de Duarte. Duas pÃ­lulas foram trocadas por comprimidos de aparÃªncia idÃªntica mas composiÃ§Ã£o diferente â€” um sedativo potente. A morte pode nÃ£o ter sido natural.',
        suspects:['Mary','Stephany','Pollyana'],
        timelineEntry:{time:'Antes da morte',text:'Os remÃ©dios de <strong>Duarte</strong> foram manipulados â€” sedativo substituÃ­do pelo cardÃ­aco.'},
        isKey: true,
      },
    ]
  },
  {
    id:'jardim',
    name:'Jardim / EstÃ¡bulo',
    icon:'ğŸŒ¿',
    hint:'Ãrea externa â€” rota de fuga?',
    color:'#106030',
    desc:'O jardim estÃ¡ encharcado do orvalho da madrugada. Uma trilha de pisadas leva do corredor lateral atÃ© o estÃ¡bulo convertido em garagem. A portinhola dos fundos estÃ¡ destrancada â€” de dentro.',
    atmosphere:'AlguÃ©m saiu. Ou voltou. A terra Ãºmida guarda a verdade.',
    clues:[
      {
        id:'c_pegadas',
        icon:'ğŸ‘£',
        name:'Trilha de Pisadas â€” Dois Pares',
        text:'Dois conjuntos de pegadas no barro: um maior (provavelmente masculino), um menor. SaÃ­ram juntos e voltaram separados. As pegadas menores terminam perto da porta da cozinha. As maiores, perto da entrada do escritÃ³rio.',
        suspects:['Eros','Carluz','Mary'],
        timelineEntry:{time:'Madrugada',text:'Duas pessoas saÃ­ram juntas pelo jardim durante a madrugada â€” e voltaram separadas.'},
      },
      {
        id:'c_envelope',
        icon:'ğŸ“¬',
        name:'Envelope Queimado Parcialmente',
        text:'Na lata de lixo do estÃ¡bulo: um envelope parcialmente queimado. O endereÃ§amento sobreviveu: "Para ser aberto somente apÃ³s minha morte â€” Duarte Vasconcelos." O conteÃºdo foi retirado antes da queima. AlguÃ©m tentou destruir a prova da existÃªncia desse envelope.',
        suspects:['Pollyana','Joy','Eros'],
        timelineEntry:{time:'Noite',text:'Um envelope lacrado de <strong>Duarte</strong> foi aberto e seu conteÃºdo removido.'},
        isKey: true,
      },
    ]
  },
  {
    id:'cozinha',
    name:'Cozinha',
    icon:'â˜•',
    hint:'CoraÃ§Ã£o da villa â€” sempre movimentada',
    color:'#802010',
    desc:'Cheira a cafÃ© forte e erva cidreira. A cafeteira tem marcaÃ§Ã£o de preparo â€” 2h47 da madrugada. Dois canecÃµes foram usados. Na pia, lavados Ã s pressas: duas xÃ­caras com resÃ­duos de chÃ¡ de ervas. Na bancada: um mortar com resÃ­duos de planta moÃ­da.',
    atmosphere:'Conversas que nÃ£o deveriam acontecer acontecem na cozinha de madrugada.',
    clues:[
      {
        id:'c_cafe',
        icon:'â˜•',
        name:'CafÃ© das 2h47 â€” Dois CanecÃµes',
        text:'A cafeteira automÃ¡tica registra o Ãºltimo preparo: 2h47. Dois canecÃµes foram usados e mal lavados. AlguÃ©m estava acordado a quase 3h da manhÃ£ â€” e tinha companhia.',
        suspects:['Mary','Carluz','Eros'],
        timelineEntry:{time:'2h47',text:'Duas pessoas tomaram cafÃ© na cozinha a quase 3h da madrugada.'},
      },
      {
        id:'c_ervas',
        icon:'ğŸŒ±',
        name:'Mortar com Ervas Sedativas',
        text:'Na bancada: resÃ­duos de valeriana, passiflora e uma terceira erva no mortar. Combinadas em alta concentraÃ§Ã£o, causam sedaÃ§Ã£o profunda â€” idÃªntica aos efeitos de uma parada cardÃ­aca em pessoas com histÃ³rico de arritmia. Mary tem conhecimento de fitoterapia.',
        suspects:['Mary','Stephany'],
        timelineEntry:{time:'Antes da morte',text:'Ervas sedativas foram processadas na cozinha â€” potencialmente adicionadas Ã  medicaÃ§Ã£o de <strong>Duarte</strong>.'},
        isKey: true,
      },
    ]
  },
  {
    id:'garagem',
    name:'Garagem / Adega',
    icon:'ğŸ¾',
    hint:'Lugar de segredos guardados',
    color:'#404060',
    desc:'A adega tem uma Ã¡rea privatizada com cadeado â€” aberto com forÃ§a. Dentro: garrafas raras e, no fundo, uma caixa de metal enferrujada. A caixa estÃ¡ vazia, mas o fundo tem papel amassado com nÃºmeros: pode ser outra combinaÃ§Ã£o.',
    atmosphere:'Nem todos os segredos ficam no cofre principal.',
    clues:[
      {
        id:'c_caixa',
        icon:'ğŸ“¦',
        name:'Caixa MetÃ¡lica Vazia â€” CombinaÃ§Ã£o',
        text:'Caixa de metal aberta com forÃ§a. No fundo: papel com "13 Â· 07 Â· 1952" â€” a data de nascimento de Duarte. Era uma combinaÃ§Ã£o de backup? O cofre principal tem combinaÃ§Ã£o diferente â€” alguÃ©m conhecia as duas.',
        suspects:['Pollyana','Stephany','Joy'],
        timelineEntry:{time:'Noite',text:'Uma caixa secreta na adega foi forÃ§ada aberta â€” provavelmente com documentos adicionais.'},
      },
      {
        id:'c_gravacao',
        icon:'ğŸ™ï¸',
        name:'Gravador â€” Mensagem de Voz',
        text:'Escondido sob um pano: um gravador analÃ³gico. A fita estÃ¡ quase no fim. A Ãºltima gravaÃ§Ã£o â€” qualidade ruim mas audÃ­vel: voz masculina, possivelmente Duarte: "...se algo me acontecer antes de amanhÃ£, saibam que foi ela quem me avisou. Mel tinha razÃ£o desde o inÃ­cio. O testamento estÃ¡ em..."  â€” A fita para abruptamente.',
        suspects:['Mel','Joy','Stephany'],
        timelineEntry:{time:'Antes da morte',text:'<strong>Duarte</strong> gravou uma mensagem de emergÃªncia â€” a fita foi cortada propositalmente.'},
        isKey: true,
      },
    ]
  },
];

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INTERROGATION DATA
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const INTERROGATIONS = {

  Joy: {
    intro: 'Joy estÃ¡ no terraÃ§o, de frente para o jardim. NÃ£o se levanta quando vocÃª chega. Acende um cigarro sem te oferecer um.',
    questions: [
      {
        q: 'Onde vocÃª estava depois das 22h?',
        a: 'No terraÃ§o. Com o meu vinho. Sozinha. Onde qualquer pessoa com dignidade estaria depois daquela farsa de jantar.',
        clue: null, lie: false,
        suspectDelta:{Joy:5},
      },
      {
        q: 'VocÃª sabia o que estava no testamento?',
        a: '<em>(longa pausa)</em> Sabia que meu pai tinha ficado louco nos Ãºltimos anos. NÃ£o sabia que teria chegado a esse ponto.',
        clue: 'âš ï¸ Joy sabia que seria prejudicada no testamento. Motivo sÃ³lido.',
        lie: false,
        suspectDelta:{Joy:20},
        connection:{chars:['Joy','Mel'],desc:'Joy sabia da existÃªncia de Mel e da mudanÃ§a testamentÃ¡ria antes da noite.'},
      },
      {
        q: 'Do terraÃ§o dÃ¡ pra ver o escritÃ³rio. VocÃª viu algo?',
        a: '<em>(hesita. Fuma)</em> Vi a luz acender Ã s 23h e apagar Ã s 23h40. Depois acender de novo perto de 1h. NÃ£o vi quem entrou. Estava... ocupada pensando.',
        clue: 'ğŸ” CRUCIAL: O escritÃ³rio foi visitado Ã s 23h e de novo Ã  1h â€” dois momentos distintos.',
        lie: false,
        suspectDelta:{Joy:0},
        timelineEntry:{time:'23h / 1h',text:'<strong>Joy</strong> confirma: luz do escritÃ³rio acendeu em dois horÃ¡rios diferentes.'},
      },
      {
        q: 'VocÃª tinha acesso Ã  combinaÃ§Ã£o do cofre?',
        a: 'NÃ£o. Meu pai nunca me deu essa informaÃ§Ã£o. Achou que eu usaria pra mal.',
        clue: null, lie: true,
        lieNote: 'O diÃ¡rio de Duarte registra que ele mostrou a combinaÃ§Ã£o a Joy em 2019 "em caso de emergÃªncia". Ela sabia.',
        suspectDelta:{Joy:25},
      },
      {
        q: 'VocÃª tomou algo para dormir esta noite?',
        a: '<em>(ri amargamente)</em> Tomei o que sempre tomo. O vinho da adega dele. Bastante.',
        clue: null, lie: false,
        suspectDelta:{Joy:-5},
      },
      {
        q: 'Onde vocÃª acha que estÃ¡ o testamento?',
        a: '<em>(te olha nos olhos pela primeira vez)</em> Acho que alguÃ©m que tinha muito mais a perder do que eu foi buscar antes que a gente acordasse. E acho que vocÃª sabe exatamente quem.',
        clue: 'âš ï¸ Joy implica que outra pessoa tinha motivo ainda maior â€” mas nÃ£o nomeia.',
        lie: false,
        suspectDelta:{Joy:-10},
      },
    ]
  },

  Ellie: {
    intro: 'Ellie estÃ¡ na biblioteca quando vocÃª a encontra â€” mesmo com tudo acontecendo, estava lendo. Fecha o livro devagar. Te observa.',
    questions: [
      {
        q: 'Onde vocÃª estava depois do jantar?',
        a: 'Aqui. Lendo. Depois fui dormir cedo â€” antes de meia-noite. NÃ£o sou boa com reuniÃµes de famÃ­lia.',
        clue: null, lie: true,
        lieNote: 'A cafeteira registra dois canecÃµes a 2h47. Ellie foi vista pelo espelho do corredor Ã s 2h pela Mary.',
        suspectDelta:{Ellie:15},
      },
      {
        q: 'VocÃª e sua irmÃ£ Joy se dÃ£o bem?',
        a: '<em>(pequena pausa)</em> A Joy Ã© a Joy. Ela sempre quis tudo. Eu aprendi a querer menos. Funciona melhor.',
        clue: null, lie: false,
        suspectDelta:{Ellie:0},
      },
      {
        q: 'VocÃª sabia da existÃªncia de Mel?',
        a: '<em>(olha para longe)</em> Meu pai tinha segredos. Alguns eu sabia. Outros... aprendi esta noite com os outros.',
        clue: 'âš ï¸ Resposta evasiva â€” Ellie pode saber mais do que admite sobre Mel.',
        lie: false,
        suspectDelta:{Ellie:10},
      },
      {
        q: 'VocÃª tem conhecimento de botÃ¢nica ou plantas medicinais?',
        a: 'Algum. Minha mÃ£e cultivava ervas no jardim quando Ã©ramos novas. Aprendi o bÃ¡sico.',
        clue: 'ğŸ” Ellie tem conhecimento de ervas â€” relevante dado o mortar na cozinha.',
        lie: false,
        suspectDelta:{Ellie:20},
        connection:{chars:['Ellie','Mary'],desc:'Tanto Ellie quanto Mary tÃªm conhecimento de plantas medicinais.'},
      },
      {
        q: 'VocÃª suspeita de alguÃ©m?',
        a: '<em>(considera longamente)</em> A Stephany redigiu o testamento. SÃ³ ela sabia o conteÃºdo completo. E ela foi a Ãºnica que pareceu... menos surpresa quando a Joy entrou em colapso.',
        clue: 'âš ï¸ Ellie aponta Stephany. Mas Stephany tinha tudo a perder revelando o documento â€” nÃ£o ocultando.',
        lie: false,
        suspectDelta:{Ellie:0,Stephany:15},
      },
    ]
  },

  Stephany: {
    intro: 'Stephany estÃ¡ ao telefone quando vocÃª entra. Encerra a ligaÃ§Ã£o â€” "Depois." â€” e te recebe com a postura de quem passou a vida em salas de tribunal.',
    questions: [
      {
        q: 'VocÃª redigiu o testamento. O que estava escrito?',
        a: 'Isso Ã© protegido por sigilo profissional. Posso confirmar que havia uma divisÃ£o nÃ£o convencional da fortuna e que havia clÃ¡usulas especÃ­ficas para situaÃ§Ãµes de morte suspeita.',
        clue: 'ğŸ” Havia clÃ¡usulas para morte suspeita â€” Duarte temia ser assassinado?',
        lie: false,
        suspectDelta:{Stephany:10},
        timelineEntry:{time:'Contexto',text:'<strong>Duarte</strong> incluiu clÃ¡usulas de morte suspeita no testamento â€” sabia do risco.'},
      },
      {
        q: 'Onde vocÃª estava depois das 22h?',
        a: 'No meu quarto. Acordei Ã s 7h com o grito da Mary. NÃ£o saÃ­ da cama depois das 22h30.',
        clue: null, lie: true,
        lieNote: 'Rastro de areia branca dos mosaicos do terraÃ§o foi encontrado no tapete do corredor perto do quarto de Stephany. Ela saiu.',
        suspectDelta:{Stephany:25},
      },
      {
        q: 'Quem mais conhecia a combinaÃ§Ã£o do cofre?',
        a: 'O Sr. Duarte e eu. Ponto final. A combinaÃ§Ã£o nÃ£o foi compartilhada com nenhum herdeiro por instruÃ§Ã£o expressa dele.',
        clue: null, lie: false,
        suspectDelta:{Stephany:15},
      },
      {
        q: 'Se o testamento desapareceu, quem Ã© beneficiado?',
        a: '<em>(escolhe bem as palavras)</em> Sem testamento vÃ¡lido, a heranÃ§a segue a sucessÃ£o legal. As filhas legÃ­timas â€” Joy e Ellie â€” dividem tudo. Mel nÃ£o recebe nada. Eros e Pollyana perdem participaÃ§Ã£o.',
        clue: 'âš ï¸ SEM testamento: Joy e Ellie ganham tudo. COM testamento: Mel, Pollyana e Eros ganham mais.',
        lie: false,
        suspectDelta:{Stephany:0,Joy:10,Ellie:10},
        connection:{chars:['Joy','Ellie'],desc:'Sem testamento, Joy e Ellie herdam tudo â€” maior motivo para o furto.'},
      },
      {
        q: 'VocÃª acha que a morte foi natural?',
        a: '<em>(pausa longa. Te olha nos olhos)</em> Duarte tinha 74 anos e histÃ³rico cardÃ­aco. A causa oficial Ã© parada cardÃ­aca. Mas ele estava bem ontem de tarde â€” conversamos por 40 minutos. Ele estava... resolvido. Em paz.',
        clue: 'âš ï¸ Stephany sugere indiretamente que a morte pode nÃ£o ter sido natural.',
        lie: false,
        suspectDelta:{Stephany:-5},
        timelineEntry:{time:'Tarde',text:'<strong>Stephany</strong> e Duarte conversaram por 40 minutos Ã  tarde â€” ele estava "em paz".'},
      },
    ]
  },

  Mary: {
    intro: 'Mary estÃ¡ na cozinha. Chorando nÃ£o â€” mas os olhos estÃ£o vermelhos. Prepara chÃ¡ enquanto fala. Seus movimentos sÃ£o precisos demais para alguÃ©m destruÃ­do.',
    questions: [
      {
        q: 'VocÃª trabalhava com Duarte hÃ¡ 11 anos. O que aconteceu esta noite?',
        a: '<em>(pausa)</em> Eu servi o jantar. Recolhi as louÃ§as. Fui pra cozinha e fiquei lÃ¡ atÃ© tarde porque nÃ£o conseguia dormir. Acordei com o grito da Joy.',
        clue: null, lie: false,
        suspectDelta:{Mary:5},
      },
      {
        q: 'VocÃª conhecia a medicaÃ§Ã£o de Duarte?',
        a: 'Controlava hÃ¡ seis anos. Comprava, separava, lembrava quando tomar. Era de confianÃ§a total.',
        clue: 'âš ï¸ Mary tinha acesso e conhecimento total da medicaÃ§Ã£o â€” e sabia manipulÃ¡-la.',
        lie: false,
        suspectDelta:{Mary:25},
      },
      {
        q: 'VocÃª sabe o que estava no testamento?',
        a: 'Sabia de algumas partes. O sr. Duarte me contava as coisas. Mas nÃ£o tudo.',
        clue: 'ğŸ” Mary sabia parte do testamento â€” possivelmente sabia que seria bem contemplada.',
        lie: false,
        suspectDelta:{Mary:10},
        connection:{chars:['Mary','Duarte'],desc:'Mary era confidente pessoal de Duarte e conhecia partes do testamento.'},
      },
      {
        q: 'VocÃª tem conhecimento de fitoterapia?',
        a: '<em>(olha para a janela)</em> Minha avÃ³ me ensinou muito sobre plantas. Tenho um caderno com receitas. O sr. Duarte me deixava cultivar ervas no jardim. Era de uso medicinal.',
        clue: 'âš ï¸ Mary confirma conhecimento avanÃ§ado de fitoterapia â€” relevante dado o mortar com sedativos.',
        lie: false,
        suspectDelta:{Mary:30},
      },
      {
        q: 'VocÃª viu alguÃ©m no corredor durante a madrugada?',
        a: 'Vi a Ellie perto das 2h. Ela foi ao banheiro â€” pelo menos foi o que eu presumi. Mas ela demorou.',
        clue: 'ğŸ” Mary viu Ellie no corredor Ã s 2h â€” contradiz o Ã¡libi de Ellie.',
        lie: false,
        suspectDelta:{Mary:0,Ellie:20},
        timelineEntry:{time:'2h',text:'<strong>Mary</strong> viu <strong>Ellie</strong> no corredor Ã s 2h da madrugada.'},
      },
      {
        q: 'O que vocÃª acha que aconteceu com o testamento?',
        a: '<em>(coloca o chÃ¡ na mesa. Para de mexer. Fala baixo)</em> Acho que alguÃ©m fez o que sempre faz quando nÃ£o gosta de uma verdade: escondeu ela. Mas a verdade que estava naquele papel... ela continua existindo. Duarte se certificou disso.',
        clue: 'ğŸ” Mary insinua que Duarte tinha uma cÃ³pia backup ou prova adicional do testamento.',
        lie: false,
        suspectDelta:{Mary:-5},
      },
    ]
  },

  Mel: {
    intro: 'Mel estÃ¡ sozinha no jardim, sentada no banco de pedra. Quando vocÃª chega, ela nÃ£o foge â€” estava esperando. "Eu sei que preciso falar com alguÃ©m."',
    questions: [
      {
        q: 'Quando vocÃª soube que era filha do Duarte?',
        a: 'TrÃªs meses atrÃ¡s. Ele me encontrou. Disse que tinha cometido um erro enorme deixando minha mÃ£e ir embora. Que queria corrigir isso no testamento.',
        clue: 'ğŸ” Mel foi encontrada por Duarte 3 meses atrÃ¡s â€” os outros nÃ£o sabiam.',
        lie: false,
        suspectDelta:{Mel:0},
        connection:{chars:['Mel','Joy'],desc:'Mel era a grande revelaÃ§Ã£o do testamento â€” o que anularia anos de expectativa de Joy.'},
        timelineEntry:{time:'3 meses atrÃ¡s',text:'<strong>Duarte</strong> encontrou <strong>Mel</strong> e decidiu incluÃ­-la no testamento.'},
      },
      {
        q: 'Onde vocÃª estava depois da meia-noite?',
        a: 'No jardim atÃ© por volta de 1h â€” precisava de ar, estava ansiosa. Depois fui ao escritÃ³rio.',
        clue: null, lie: false,
        suspectDelta:{Mel:10},
      },
      {
        q: 'VocÃª foi ao escritÃ³rio de Duarte durante a noite?',
        a: '<em>(respira fundo)</em> Fui. Ele me chamou â€” Ã s 23h. Tomamos bourbon juntos. Ele me mostrou onde o testamento estava guardado. Queria que eu soubesse. Quando saÃ­, ele estava vivo.',
        clue: 'âš ï¸ REVELAÃ‡ÃƒO: Mel esteve no escritÃ³rio Ã s 23h â€” e sabe onde o testamento estava.',
        lie: false,
        suspectDelta:{Mel:15},
        timelineEntry:{time:'23h',text:'<strong>Mel</strong> esteve no escritÃ³rio â€” Duarte mostrou onde o testamento estava guardado.'},
      },
      {
        q: 'VocÃª sabe quem pode ter pegado o testamento?',
        a: '<em>(engole seco)</em> Quando eu saÃ­, Ã s 23h40 ou por aÃ­, vi uma sombra no corredor. Escondida. Esperando. Eu reconheci os sapatos â€” eram sapatos caros. Vermelhos.',
        clue: 'âš ï¸ CHAVE: Mel viu alguÃ©m esperando no corredor quando saiu â€” sapatos vermelhos.',
        lie: false,
        suspectDelta:{Mel:0,Joy:30,Pollyana:15},
        timelineEntry:{time:'23h40',text:'<strong>Mel</strong> viu uma sombra com sapatos vermelhos no corredor ao sair do escritÃ³rio.'},
      },
      {
        q: 'VocÃª tem medo de alguma pessoa aqui?',
        a: 'Tenho medo do que as pessoas fazem quando sentem que vÃ£o perder algo. Qualquer pessoa daquela sala ontem Ã  noite tinha motivo para me detestar â€” eu sou a razÃ£o pela qual metade deles perde parte da heranÃ§a.',
        clue: null, lie: false,
        suspectDelta:{Mel:-5},
      },
    ]
  },

  Eros: {
    intro: 'Eros estÃ¡ impecavelmente vestido para uma manhÃ£ apÃ³s morte de familiar. LÃª algo no telefone quando vocÃª entra. Guarda o aparelho com calma desconcertante.',
    questions: [
      {
        q: 'Como vocÃª Ã© relacionado ao Duarte?',
        a: 'Primo distante. Mas ele me considerava prÃ³ximo nos Ãºltimos anos. Cuidava dos investimentos internacionais dele. Uma relaÃ§Ã£o de confianÃ§a.',
        clue: null, lie: false,
        suspectDelta:{Eros:0},
      },
      {
        q: 'VocÃª sabia que estaria no testamento?',
        a: '<em>(leve sorriso)</em> Ele sugeriu. Nunca confirmou. Eu nÃ£o fazia negÃ³cios com base em expectativas.',
        clue: null, lie: true,
        lieNote: 'Emails encontrados entre Eros e Duarte mostram que ele sabia exatamente quanto receberia e estava planejando investimentos com esse dinheiro.',
        suspectDelta:{Eros:20},
      },
      {
        q: 'Onde vocÃª estava depois do jantar?',
        a: 'Na sala com o Carluz atÃ© umas 2h. Depois fomos ao jardim tomar ar. Voltei pelo caminho da cozinha.',
        clue: 'ğŸ” Eros confirma saÃ­da ao jardim na madrugada â€” correspondendo Ã s pegadas duplas no barro.',
        lie: false,
        suspectDelta:{Eros:5},
        timelineEntry:{time:'2h+',text:'<strong>Eros</strong> e <strong>Carluz</strong> saÃ­ram juntos pelo jardim â€” e voltaram separados.'},
      },
      {
        q: 'VocÃª tem acesso a informaÃ§Ãµes sobre compostos sedativos?',
        a: '<em>(pausa calculada)</em> Invisto em farmacÃªuticas. Tenho conhecimento geral do setor. Por que pergunta?',
        clue: 'âš ï¸ Eros tem conhecimento farmacÃªutico â€” potencialmente sabe sobre sedativos cardÃ­acos.',
        lie: false,
        suspectDelta:{Eros:20},
      },
      {
        q: 'O que Carluz fez quando vocÃªs se separaram no jardim?',
        a: '<em>(pausa longa)</em> Ele disse que ia fumar. Mas Carluz nÃ£o fuma. Eu nÃ£o perguntei mais.',
        clue: 'âš ï¸ Carluz mentiu para Eros sobre seus planos no jardim. O que fez sozinho?',
        lie: false,
        suspectDelta:{Eros:0,Carluz:25},
        connection:{chars:['Eros','Carluz'],desc:'Eros e Carluz tÃªm uma alianÃ§a â€” mas com rachaduras. Carluz mentiu sobre seus planos.'},
      },
    ]
  },

  Carluz: {
    intro: 'Carluz parece ter dormido mal â€” ou nÃ£o dormiu. EstÃ¡ na sala com o cafÃ© jÃ¡ frio. Quando vocÃª entra, salta da poltrona mais rÃ¡pido do que deveria.',
    questions: [
      {
        q: 'VocÃª foi excluÃ­do do testamento. Como ficou sabendo?',
        a: 'Meu tio me avisou hÃ¡ duas semanas. Disse que havia mudado de ideia. NÃ£o quis explicar. Disse que eu entenderia "quando o momento certo chegasse".',
        clue: 'ğŸ” Carluz foi avisado da exclusÃ£o com duas semanas de antecedÃªncia â€” tempo para planejar.',
        lie: false,
        suspectDelta:{Carluz:10},
        timelineEntry:{time:'2 semanas antes',text:'<strong>Duarte</strong> informou <strong>Carluz</strong> de sua exclusÃ£o do testamento.'},
      },
      {
        q: 'Onde vocÃª estava depois da meia-noite?',
        a: 'Com o Eros. Na sala atÃ© 2h, depois no jardim. Voltei para a sala depois.',
        clue: null, lie: true,
        lieNote: 'Eros revela que Carluz mentiu sobre ir "fumar" â€” eles se separaram no jardim e Carluz foi ao outro lado da villa.',
        suspectDelta:{Carluz:20},
      },
      {
        q: 'VocÃª precisava do dinheiro da heranÃ§a?',
        a: '<em>(olha para o lado)</em> Tenho alguns investimentos mal colocados. Mas nÃ£o Ã© um problema que nÃ£o possa resolver.',
        clue: 'âš ï¸ Carluz minimiza â€” registros indicam dÃ­vidas de R$ 340k com prazo curto de vencimento.',
        lie: true,
        lieNote: 'Carluz estÃ¡ endividado de forma grave. A heranÃ§a era a Ãºnica saÃ­da financeira.',
        suspectDelta:{Carluz:30},
        connection:{chars:['Carluz'],desc:'Carluz tem dÃ­vidas graves â€” a heranÃ§a era essencial para sua sobrevivÃªncia financeira.'},
      },
      {
        q: 'VocÃª tentou copiar a chave do cofre?',
        a: '<em>(engole. Pausa)</em> Que chave do cofre? Eu nÃ£o tenho acesso ao escritÃ³rio.',
        clue: null, lie: true,
        lieNote: 'A impressÃ£o de chave na biblioteca ainda tem traÃ§os de argila idÃªntica aos sapatos que Carluz usava ontem.',
        suspectDelta:{Carluz:35},
      },
      {
        q: 'VocÃª abre o envelope queimado no estÃ¡bulo?',
        a: '<em>(reage visivelmente)</em> Eu... o que? Eu nÃ£o sei do que vocÃª estÃ¡ falando.',
        clue: 'âš ï¸ Carluz claramente reconheceu o que vocÃª descreveu â€” e ficou assustado.',
        lie: true,
        lieNote: 'A reaÃ§Ã£o de Carluz indica conhecimento do envelope â€” e do que havia dentro.',
        suspectDelta:{Carluz:40},
      },
    ]
  },

  Pollyana: {
    intro: 'Pollyana estÃ¡ arrumando as malas quando vocÃª a encontra. Lentamente. Com a calma de quem jÃ¡ processou tudo. "Eu sabia que vocÃª viria atÃ© mim por Ãºltimo."',
    questions: [
      {
        q: 'Por que estÃ¡ arrumando as malas?',
        a: 'Porque o que eu vim buscar aqui nÃ£o existe mais. A presenÃ§a dele nÃ£o existe mais. O resto Ã© burocracia.',
        clue: null, lie: false,
        suspectDelta:{Pollyana:5},
      },
      {
        q: 'VocÃª era a herdeira principal no testamento anterior. Como se sente agora?',
        a: '<em>(para de dobrar a roupa)</em> O Duarte tinha o direito de mudar de ideia. NÃ£o me tornei inimiga da Mel por isso. Ela Ã© filha dele. Faz sentido.',
        clue: 'ğŸ” Pollyana aceita a mudanÃ§a com calma incomum â€” genuÃ­no ou disfarce?',
        lie: false,
        suspectDelta:{Pollyana:10},
      },
      {
        q: 'Onde vocÃª estava depois das 22h?',
        a: 'No quarto lendo atÃ© meia-noite. Depois fui tomar Ã¡gua na cozinha. Vi a Mary lÃ¡. Depois voltei e dormi.',
        clue: null, lie: false,
        suspectDelta:{Pollyana:0},
        connection:{chars:['Pollyana','Mary'],desc:'Pollyana e Mary se encontraram na cozinha depois da meia-noite.'},
      },
      {
        q: 'VocÃª usava sapatos vermelhos ontem Ã  noite?',
        a: '<em>(longa pausa. Te olha nos olhos)</em> NÃ£o. Eu usava os meus de couro marrom. Sempre uso quando viajo. Por que?',
        clue: null, lie: false,
        suspectDelta:{Pollyana:-10,Joy:15},
      },
      {
        q: 'VocÃª acha que a morte do Duarte foi natural?',
        a: '<em>(fecha a mala. Se vira totalmente para vocÃª)</em> OuÃ§a. HÃ¡ seis meses, o Duarte me contou que tinha recebido ameaÃ§as â€” cartas anÃ´nimas. Ele guardou todas. Pediu que eu nÃ£o contasse. Disse que tinha certeza de quem era, mas precisava de prova. Essas cartas estÃ£o escondidas no fundo do baÃº de roupas do quarto dele.',
        clue: 'âš ï¸ REVELAÃ‡ÃƒO MAJOR: Duarte recebia ameaÃ§as. Cartas escondidas no quarto.',
        lie: false,
        suspectDelta:{Pollyana:-20,Joy:20,Carluz:20},
        timelineEntry:{time:'6 meses',text:'<strong>Duarte</strong> recebia cartas de ameaÃ§a anÃ´nimas â€” e guardou todas como evidÃªncia.'},
        isKey: true,
      },
      {
        q: 'Por que vocÃª nÃ£o contou isso antes?',
        a: 'Porque ele pediu. E porque eu queria encontrar as cartas primeiro para ter certeza que ainda estavam lÃ¡. <em>(olha para a janela)</em> EstÃ£o. Acabei de verificar esta manhÃ£.',
        clue: 'ğŸ” As cartas de ameaÃ§a ainda existem â€” evidÃªncia fÃ­sica que aponta para o culpado.',
        lie: false,
        suspectDelta:{Pollyana:-10},
      },
    ]
  },
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  A VERDADE (oculta do jogador)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const TRUTH = {
  culpado: 'Carluz',
  motivo: 'divida',
  metodo: 'chave',
  story: {
    Carluz_perfeito: {
      type: 'correct',
      headline: 'DETETIVE DESVENDA O CRIME DA VILLA OBSCURA',
      text: [
        'A verdade, como sempre, estava enterrada sob camadas de aparÃªncia. <strong>Carluz</strong> â€” o sobrinho excluÃ­do, o endividado, o desesperado â€” era o Ãºnico naquele grupo que nÃ£o tinha nada a perder sendo tudo perdido.',
        'Duas semanas antes, ao ser informado de sua exclusÃ£o, Carluz comeÃ§ou a agir. Ele foi Ã  biblioteca de estudo e, com argila que trazia nos sapatos do jardim, tentou reproduzir a chave do cofre usando a impressora de pÃ³. NÃ£o conseguiu uma cÃ³pia funcional â€” mas durante essa pesquisa encontrou o segundo documento: o endereÃ§o da caixa metÃ¡lica na adega, com a combinaÃ§Ã£o de backup.',
        'Na noite do jantar, Carluz fingiu ir com Eros ao jardim Ã s 2h, separou-se dele e foi Ã  adega. ForÃ§ou a caixa, encontrou ali uma cÃ³pia impressa do testamento â€” que Duarte havia guardado como backup. <strong>Carluz levou o documento e o parcialmente queimou no estÃ¡bulo</strong>, acreditando que destruiria a evidÃªncia. Esqueceu o envelope.',
        'Quanto Ã  morte de Duarte: ela foi natural. A manipulaÃ§Ã£o dos remÃ©dios era de muito antes â€” um ensaio de Mary, que nunca chegou a executar seu plano. Duarte morreu de coraÃ§Ã£o essa noite, por coincidÃªncia ou destino. Carluz nÃ£o planejou a morte â€” planejou o roubo. A confusÃ£o gerada pela morte foi o acidente que quase o livrou.',
        '<em>A heranÃ§a serÃ¡ distribuÃ­da conforme o testamento digital que Stephany guardava criptografado â€” Duarte tinha previsto a possibilidade de o original desaparecer.</em>',
      ]
    },
    Carluz_motivo_errado: {
      type: 'partial',
      headline: 'ACUSAÃ‡ÃƒO CERTA â€” MOTIVO IMPRECISO',
      text: [
        'VocÃª chegou ao culpado certo: <strong>Carluz</strong>. Mas o motivo era mais simples e urgente do que pareceu.',
        'NÃ£o era vinganÃ§a nem ressentimento â€” era desespero financeiro puro. R$340 mil em dÃ­vidas com prazo de vencimento em 30 dias. A heranÃ§a era a Ãºnica saÃ­da. Quando foi excluÃ­do, nÃ£o encontrou outra alternativa que nÃ£o fosse interferir.',
        'O roubo do testamento era uma aposta: sem o documento, a heranÃ§a seguiria a lei â€” e ele, como herdeiro legal pela linha familiar, receberia uma parte. Calculou mal, porque Stephany tinha cÃ³pia digital.',
        '<em>A investigaÃ§Ã£o foi sÃ³lida. Faltou entender que crime desesperado raramente vem de Ã³dio.</em>',
      ]
    },
    Carluz_metodo_errado: {
      type: 'partial',
      headline: 'ACUSAÃ‡ÃƒO CERTA â€” MÃ‰TODO INCORRETO',
      text: [
        '<strong>Carluz</strong> era o culpado, sim. Mas o mÃ©todo foi diferente do que vocÃª imaginou.',
        'Ele nÃ£o usou a combinaÃ§Ã£o do cofre principal â€” na verdade, nunca conseguiu isso. Acessou uma cÃ³pia do testamento guardada em uma caixa metÃ¡lica secundÃ¡ria na adega, com a combinaÃ§Ã£o de backup que descobriu na biblioteca.',
        'O cofre principal provavelmente foi aberto por Joy, que sabia a combinaÃ§Ã£o â€” mas ela abriu apenas para olhar, e devolveu o documento original para o lugar. Carluz roubou a cÃ³pia. DistinÃ§Ã£o crucial.',
        '<em>Boa investigaÃ§Ã£o. O detalhe do mÃ©todo foi o mais difÃ­cil de reconstituir.</em>',
      ]
    },
    Joy: {
      type: 'wrong',
      headline: 'ACUSAÃ‡ÃƒO ERRADA â€” JOY Ã‰ INOCENTE DO ROUBO',
      text: [
        'Joy tinha motivo, oportunidade e temperamento â€” a suspeita mais Ã³bvia. Mas nÃ£o roubou o testamento.',
        'Ela estava no terraÃ§o fumando e viu os movimentos. Quando Mel saiu do escritÃ³rio Ã s 23h40, Joy entrou â€” e abriu o cofre com a combinaÃ§Ã£o que seu pai lhe dera anos atrÃ¡s. Leu o testamento. Ficou destruÃ­da. Mas devolveu o documento exatamente onde estava.',
        'Joy cometeu invasÃ£o de privacidade. NÃ£o roubou. Quem roubou foi <strong>Carluz</strong> â€” a cÃ³pia guardada na adega, que Joy nem sabia que existia.',
        '<em>A acusaÃ§Ã£o mais tentadora Ã© raramente a correta. Investigar mais revelaria o rastro de argila nos sapatos de Carluz.</em>',
      ]
    },
    Mary: {
      type: 'wrong',
      headline: 'ACUSAÃ‡ÃƒO ERRADA â€” MARY NÃƒO ROUBOU O TESTAMENTO',
      text: [
        'Mary Ã© a mais culpada do grupo â€” mas nÃ£o pelo roubo do testamento.',
        'Ela manipulou os remÃ©dios de Duarte hÃ¡ meses â€” um plano que nunca chegou a executar porque hesitou. Duarte morreu de causa natural antes disso. Mary carrega uma culpa real â€” de intenÃ§Ã£o, nÃ£o de aÃ§Ã£o.',
        'Mas o testamento foi roubado por <strong>Carluz</strong>, nÃ£o por Mary. Mary estava na cozinha fazendo chÃ¡ Ã s 2h47 â€” com Ellie, que tambÃ©m nÃ£o dormiu naquela noite.',
        '<em>VocÃª encontrou o personagem mais moralmente culpado â€” mas nÃ£o o autor do roubo especÃ­fico.</em>',
      ]
    },
    other: {
      type: 'wrong',
      headline: 'ACUSAÃ‡ÃƒO INCORRETA â€” O CULPADO ESCAPA',
      text: [
        'O testamento nÃ£o foi encontrado. O culpado escapa.',
        '<strong>Carluz</strong> roubou a cÃ³pia do testamento guardada na caixa metÃ¡lica da adega. Endividado em R$340 mil, desesperado apÃ³s ser excluÃ­do, agiu na madrugada enquanto fingia estar com Eros no jardim.',
        'As pistas estavam lÃ¡: a argila dos sapatos, a impressÃ£o de chave na biblioteca, o envelope queimado, a reaÃ§Ã£o ao ser confrontado. O rastro era claro para quem soubesse onde olhar.',
        '<em>A verdade ainda estÃ¡ enterrada nessa villa. Mas com Stephany guardando cÃ³pia digital, o testamento serÃ¡ lido â€” e a heranÃ§a, distribuÃ­da.</em>',
      ]
    }
  }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GAME STATE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let G = {
  cluesFound: new Set(),
  roomsVisited: new Set(),
  charsInterrogated: new Set(),
  questionsAsked: {},
  suspicion: {Pollyana:0,Carluz:0,Eros:0,Stephany:0,Mary:0,Mel:0,Joy:0,Ellie:0},
  liesDetected: new Set(),
  connections: new Set(),
  timelineEntries: [],
  accusationData: {culpado:'',motivo:'',metodo:''},
  phase: 1,
  keyReveals: new Set(),
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  INIT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function startGame() {
  document.getElementById('splash').style.display = 'none';
  document.getElementById('game').style.display = 'block';
  buildAlibiList();
  buildRoomsGrid();
  buildCharsGrid();
  buildSuspectMeters();
  buildProgressList();
  updateTopStats();
}

function buildAlibiList() {
  const el = document.getElementById('alibi-list');
  el.innerHTML = Object.entries(CHARACTERS).map(([name,cfg]) => `
    <div class="alibi-item" id="alibi-${name}" onclick="openChar('${name}')">
      <div class="alibi-dot" style="background:${cfg.color}"></div>
      <div class="alibi-name">${name}</div>
      <div class="alibi-tag unknown" id="at-${name}">â€”</div>
    </div>
  `).join('');
}

function buildRoomsGrid() {
  const grid = document.getElementById('rooms-grid');
  grid.innerHTML = ROOMS.map(r => `
    <div class="room-card" id="room-${r.id}" style="--card-color:${r.color}" onclick="openRoom('${r.id}')">
      <div class="room-check">âœ“</div>
      <span class="room-icon">${r.icon}</span>
      <div class="room-name">${r.name}</div>
      <div class="room-hint">${r.hint}</div>
      <div class="room-clue-count" id="rcc-${r.id}"></div>
    </div>
  `).join('');
}

function buildCharsGrid() {
  const grid = document.getElementById('chars-grid');
  grid.innerHTML = Object.entries(CHARACTERS).map(([name,cfg]) => `
    <div class="char-card" id="cc-${name}" onclick="openChar('${name}')">
      <div class="char-card-banner" style="background:linear-gradient(180deg,${cfg.color}33,${cfg.color}11)">
        <span style="filter:drop-shadow(0 0 10px ${cfg.color}88)">${cfg.emoji}</span>
      </div>
      <div class="char-card-info">
        <div class="char-card-name">${name}</div>
        <div class="char-card-role">${cfg.role}</div>
        <div class="char-card-alibi">${cfg.alibi}</div>
      </div>
      <div class="char-interro-count" id="cic-${name}"></div>
    </div>
  `).join('');
}

function buildSuspectMeters() {
  const c = document.getElementById('suspect-meters');
  c.innerHTML = Object.entries(CHARACTERS).map(([name,cfg]) => `
    <div class="suspect-row" onclick="openChar('${name}')">
      <div class="sr-top">
        <div class="sr-dot" style="background:${cfg.color}"></div>
        <div class="sr-name">${name}</div>
        <div class="sr-pts" id="srp-${name}">0</div>
      </div>
      <div class="sr-bar">
        <div class="sr-fill" id="srf-${name}" style="width:0%;background:${cfg.color}"></div>
      </div>
      <div class="sr-verdict" id="srv-${name}">Sem dados</div>
    </div>
  `).join('');
}

const PROGRESS_ITEMS_DEF = [
  {id:'rooms5', text:'Investigar pelo menos 5 cÃ´modos', icon:'ğŸ›ï¸', check:()=>G.roomsVisited.size>=5},
  {id:'rooms_all', text:'Investigar todos os cÃ´modos', icon:'ğŸ—ï¸', check:()=>G.roomsVisited.size>=ROOMS.length},
  {id:'chars4', text:'Interrogar pelo menos 4 suspeitos', icon:'ğŸ‘¤', check:()=>G.charsInterrogated.size>=4},
  {id:'chars_all', text:'Interrogar todos os suspeitos', icon:'ğŸ•µï¸', check:()=>G.charsInterrogated.size>=8},
  {id:'lies3', text:'Detectar 3 ou mais mentiras', icon:'âš ï¸', check:()=>G.liesDetected.size>=3},
  {id:'clues8', text:'Coletar 8 ou mais pistas', icon:'ğŸ”', check:()=>G.cluesFound.size>=8},
  {id:'key_reveals', text:'Descobrir 3+ revelaÃ§Ãµes-chave', icon:'ğŸ’¡', check:()=>G.keyReveals.size>=3},
  {id:'theory', text:'Formular teoria completa', icon:'ğŸ“‹', check:()=>{
    const c=document.getElementById('theory-culpado')?.value;
    const m=document.getElementById('theory-motivo')?.value;
    const me=document.getElementById('theory-metodo')?.value;
    return !!(c&&m&&me);
  }},
];

function buildProgressList() {
  const el = document.getElementById('progress-list');
  el.innerHTML = PROGRESS_ITEMS_DEF.map(p=>`
    <div class="progress-item" id="prog-${p.id}">
      <span class="prog-icon">${p.icon}</span>
      <span class="prog-text">${p.text}</span>
      <span class="prog-check" id="pgc-${p.id}">â—‹</span>
    </div>
  `).join('');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ROOMS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openRoom(id) {
  const room = ROOMS.find(r=>r.id===id);
  if(!room) return;

  const isFirst = !G.roomsVisited.has(id);
  G.roomsVisited.add(id);
  document.getElementById(`room-${id}`).classList.add('visited');

  const newClues = room.clues.filter(c=>!G.cluesFound.has(c.id));
  const foundClues = room.clues.filter(c=>G.cluesFound.has(c.id));

  newClues.forEach(c=>{
    G.cluesFound.add(c.id);
    addEvidence(c);
    (c.suspects||[]).forEach(s=>{if(G.suspicion[s]!==undefined)G.suspicion[s]+=6});
    if(c.timelineEntry) addTimeline(c.timelineEntry.time, c.timelineEntry.text);
    if(c.isKey) G.keyReveals.add(c.id);
  });

  if(newClues.length>0) {
    document.getElementById(`room-${id}`).classList.remove('has-unread');
  }

  updateSuspectMeters();
  updateProgress();

  // Modal
  document.getElementById('modal-title').textContent = room.name;
  document.getElementById('modal-subtitle').textContent = room.hint;

  let body = `<div class="room-scene-text">${room.desc}</div>`;
  if(room.atmosphere) body += `<div class="room-atmosphere">${room.atmosphere}</div>`;

  if(newClues.length>0) {
    body += newClues.map(c=>`
      <div class="clue-card">
        <div class="clue-card-icon">${c.icon}</div>
        <div>
          <div class="clue-card-name">ğŸ†• ${c.name}</div>
          <div class="clue-card-text">${c.text}</div>
          ${c.suspects?.length ? `<div class="clue-card-suspects">Suspeitos relacionados: ${c.suspects.join(' Â· ')}</div>` : ''}
        </div>
      </div>`).join('');
    body += `<div style="font-size:11px;font-style:italic;color:var(--ink4);text-align:center;margin-top:12px">${newClues.length} nova(s) pista(s) adicionada(s) Ã s evidÃªncias</div>`;
  } else if(foundClues.length>0) {
    body += `<div class="clue-card already-found">
      <div class="clue-card-icon">ğŸ”</div>
      <div><div class="clue-card-name">Pistas jÃ¡ registradas</div><div class="clue-card-text">Este cÃ´modo foi examinado. Todas as pistas foram coletadas.</div></div>
    </div>`;
    body += foundClues.map(c=>`
      <div class="clue-card already-found">
        <div class="clue-card-icon">${c.icon}</div>
        <div><div class="clue-card-name">${c.name}</div><div class="clue-card-text">${c.text}</div></div>
      </div>`).join('');
  } else {
    body += `<div class="clue-card already-found">
      <div class="clue-card-icon">ğŸ¤”</div>
      <div><div class="clue-card-name">Nada encontrado aqui</div><div class="clue-card-text">VocÃª examinou cuidadosamente. Nenhuma pista relevante neste cÃ´modo.</div></div>
    </div>`;
  }

  document.getElementById('modal-body').innerHTML = body;
  document.getElementById('modal-overlay').classList.add('open');

  if(newClues.length>0) showToast(`ğŸ” ${newClues.length} pista(s) em: ${room.name}`);

  updateRoomCounter(id, room);
}

function updateRoomCounter(id, room) {
  const el = document.getElementById(`rcc-${id}`);
  if(el) {
    const found = room.clues.filter(c=>G.cluesFound.has(c.id)).length;
    el.textContent = found ? `${found}/${room.clues.length} pistas` : '';
  }
}

function addEvidence(clue) {
  const list = document.getElementById('evidence-list');
  const empty = list.querySelector('div[style]');
  if(empty) empty.remove();
  const d = document.createElement('div');
  d.className='evidence-item new';
  d.id=`ev-${clue.id}`;
  d.innerHTML=`
    <div class="ev-icon">${clue.icon}</div>
    <div>
      <div class="ev-name">${clue.name}<span class="ev-badge">NOVO</span></div>
      <div class="ev-desc">${clue.text.substring(0,90)}...</div>
    </div>`;
  list.prepend(d);
  setTimeout(()=>{
    d.classList.remove('new');
    d.querySelector('.ev-badge')?.remove();
  },6000);
}

function addTimeline(time, text) {
  const entry = {time, text};
  G.timelineEntries.push(entry);
  // Sort roughly by time label
  const list = document.getElementById('timeline-list');
  const empty = list.querySelector('div[style]');
  if(empty) empty.remove();
  const d = document.createElement('div');
  d.className='timeline-entry';
  d.innerHTML=`<div class="tl-time">${time}</div><div class="tl-text">${text}</div>`;
  list.appendChild(d);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  CHARACTER INTERROGATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openChar(name) {
  const interro = INTERROGATIONS[name];
  if(!interro) return;
  const cfg = CHARACTERS[name];
  if(!G.questionsAsked[name]) G.questionsAsked[name] = new Set();
  const isReturn = G.charsInterrogated.has(name);
  G.charsInterrogated.add(name);

  document.getElementById('modal-title').textContent = `${cfg.emoji}  ${name}`;
  document.getElementById('modal-subtitle').textContent = cfg.role + '  Â·  ' + cfg.alibi;
  renderInterrogation(name, interro, cfg, isReturn);
  document.getElementById('modal-overlay').classList.add('open');

  // Update alibi tag
  const at = document.getElementById(`at-${name}`);
  if(at && at.textContent==='â€”') {at.textContent='Interrogado';at.className='alibi-tag partial';}

  // Update char card counter
  const cic = document.getElementById(`cic-${name}`);
  const asked = (G.questionsAsked[name]||new Set()).size;
  const total = interro.questions.length;
  if(cic) cic.textContent = asked>0 ? `${asked}/${total} perguntas` : '';

  updateProgress();
}

function renderInterrogation(name, interro, cfg, isReturn) {
  const asked = G.questionsAsked[name] || new Set();

  const questionsHtml = interro.questions.map((q,qi)=>{
    const isAsked = asked.has(qi);
    const keyClass = q.isKey ? 'key-question' : '';
    return `<button class="q-btn ${keyClass} ${isAsked?'asked':''}"
      onclick="${isAsked?'':'askQuestion(\''+name+'\','+qi+')'}" ${isAsked?'disabled':''}>
      <div class="q-num">${qi+1}</div>
      <div>"${q.q}"</div>
    </button>`;
  }).join('');

  const answersHtml = [...asked].sort((a,b)=>b-a).map(qi=>{
    const q = interro.questions[qi];
    return buildAnswerHtml(name,q,qi,cfg);
  }).join('');

  const portrait = `
    <div class="interro-portrait" style="border-color:${cfg.color}33">
      <div class="interro-emoji">${cfg.emoji}</div>
      <div>
        <div class="interro-name" style="color:${cfg.color}">${name}</div>
        <div class="interro-role">${cfg.role}</div>
        <div class="interro-alibi">Ãlibi declarado: ${cfg.alibi}</div>
      </div>
    </div>`;

  document.getElementById('modal-body').innerHTML = `
    ${portrait}
    ${isReturn ? '<div class="reinquiry-note">Segundo interrogatÃ³rio â€” personagem pode ser mais receptivo</div>' : ''}
    <div class="interro-intro">${interro.intro}</div>
    <div class="question-list">${questionsHtml}</div>
    <div id="answers-area">${answersHtml}</div>
  `;
}

function buildAnswerHtml(name, q, qi, cfg) {
  const isLie = q.lie && G.liesDetected.has(`${name}-${qi}`);
  return `
    <div class="answer-card" style="--char-color:${cfg.color}">
      <div class="answer-speaker" style="color:${cfg.color}">${name}</div>
      <div class="answer-text">${q.a}</div>
      ${q.clue ? `<div class="answer-clue">ğŸ” ${q.clue}</div>` : ''}
      ${isLie ? `<div class="answer-lie">âš ï¸ MENTIRA DETECTADA: ${q.lieNote}</div>` : ''}
      ${q.connection && !q.lie ? `<div class="answer-newinfo">ğŸ•¸ï¸ ConexÃ£o descoberta: ${q.connection.desc}</div>` : ''}
    </div>`;
}

function askQuestion(name, qi) {
  const interro = INTERROGATIONS[name];
  const q = interro.questions[qi];
  const cfg = CHARACTERS[name];
  if(!q) return;

  G.questionsAsked[name].add(qi);

  // Suspicion deltas
  if(q.suspectDelta) {
    Object.entries(q.suspectDelta).forEach(([char,delta])=>{
      if(G.suspicion[char]!==undefined) G.suspicion[char] = Math.max(0,G.suspicion[char]+delta);
    });
  }

  // Lie detection â€” after at least 2 questions to same person
  if(q.lie && G.questionsAsked[name].size >= 2) {
    G.liesDetected.add(`${name}-${qi}`);
    updateAlibiStatus(name,'lied');
    showToast(`âš ï¸ Mentira detectada â€” ${name}`);
  } else if(!q.lie && !G.liesDetected.has(`${name}-${qi}`)) {
    // Maybe eventually mark as cleared
  }

  // Timeline
  if(q.timelineEntry) addTimeline(q.timelineEntry.time, q.timelineEntry.text);

  // Connection
  if(q.connection) {
    addConnection(q.connection);
  }

  // Key reveal
  if(q.isKey || (q.clue && q.clue.includes('REVELAÃ‡ÃƒO'))) {
    G.keyReveals.add(`${name}-${qi}`);
  }

  // Mark button asked
  const btns = document.querySelectorAll('.q-btn');
  btns.forEach((btn,i)=>{
    if(i===qi) {btn.classList.add('asked');btn.disabled=true;btn.onclick=null;}
  });

  // Add answer
  const area = document.getElementById('answers-area');
  if(area) {
    const div = document.createElement('div');
    div.innerHTML = buildAnswerHtml(name,q,qi,cfg);
    area.prepend(div.firstElementChild);
  }

  // Update char counter
  const cic = document.getElementById(`cic-${name}`);
  const total = interro.questions.length;
  const asked = G.questionsAsked[name].size;
  if(cic) cic.textContent = `${asked}/${total} perguntas`;

  updateSuspectMeters();
  updateProgress();

  if(q.clue) showToast(`ğŸ’¡ Nova pista: ${name}`);

  // Special: Pollyana reveals letters
  if(name==='Pollyana' && qi===4) {
    setTimeout(()=>showToast('ğŸš¨ REVELAÃ‡ÃƒO IMPORTANTE: Duarte recebia ameaÃ§as! Verifique o quarto!'),800);
  }
}

function updateAlibiStatus(name, status) {
  const el = document.getElementById(`alibi-${name}`);
  const tag = document.getElementById(`at-${name}`);
  if(!el||!tag) return;
  if(status==='lied'){
    tag.textContent='Mentiu!';tag.className='alibi-tag lied';
    el.classList.add('suspect');
    // badge on char card
    let badge = document.getElementById(`cc-${name}`)?.querySelector('.char-badge');
    if(!badge){badge=document.createElement('div');badge.className='char-badge suspect';
      document.getElementById(`cc-${name}`)?.querySelector('.char-card-banner')?.appendChild(badge);}
    badge.textContent='MENTIU';badge.className='char-badge suspect';
  } else if(status==='cleared'){
    tag.textContent='Ãlibi ok';tag.className='alibi-tag ok';
    el.classList.add('cleared');
  }
}

function addConnection(conn) {
  const key = conn.chars.sort().join('-');
  if(G.connections.has(key)) return;
  G.connections.add(key);
  const list = document.getElementById('connections-list');
  const empty = list.querySelector('div[style]');
  if(empty) empty.remove();
  const d = document.createElement('div');
  d.className='connection-item';
  d.innerHTML=`<div class="conn-names">${conn.chars.join(' â†” ')}</div><div class="conn-desc">${conn.desc}</div>`;
  list.appendChild(d);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SUSPECT METERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const VERDICTS_SCALE = [
  [0,'Sem evidÃªncias'],[15,'ImprovÃ¡vel'],[30,'Leve suspeita'],
  [50,'Suspeito moderado'],[70,'Fortemente suspeito'],
  [90,'Principal suspeito'],[110,'Quase certeza'],
];

function updateSuspectMeters() {
  const max = Math.max(...Object.values(G.suspicion),1);
  let topName='';let topVal=0;
  Object.entries(G.suspicion).forEach(([name,val])=>{
    const pct = Math.min(100,Math.round((val/Math.max(max,100))*100));
    const fill=document.getElementById(`srf-${name}`);
    const pts=document.getElementById(`srp-${name}`);
    const verd=document.getElementById(`srv-${name}`);
    if(fill)fill.style.width=pct+'%';
    if(pts)pts.textContent=val+'pts';
    if(verd){
      const v=[...VERDICTS_SCALE].reverse().find(x=>val>=x[0]);
      verd.textContent=v?v[1]:'Sem dados';
    }
    if(val>topVal){topVal=val;topName=name;}
    // Update char badge if high
    if(val>=80){
      const cc=document.getElementById(`cc-${name}`);
      if(cc){
        let badge=cc.querySelector('.char-badge:not(.suspect)');
        if(!badge){badge=document.createElement('div');badge.className='char-badge suspect';
          cc.querySelector('.char-card-banner')?.appendChild(badge);}
        if(!badge.classList.contains('suspect')){badge.className='char-badge suspect';badge.textContent='SUSPEITO';}
      }
    }
  });
  if(topName){
    const el=document.getElementById('stat-certeza');
    if(el)el.textContent=topName;
  }
  updateTopStats();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PROGRESS & PHASE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateProgress() {
  let done=0;
  PROGRESS_ITEMS_DEF.forEach(p=>{
    const ok=p.check();
    if(ok)done++;
    const el=document.getElementById(`pgc-${p.id}`);
    if(el)el.textContent=ok?'âœ“':'â—‹';
  });

  // Phase progression
  if(done>=2 && G.phase===1){
    G.phase=2;
    updatePhase('FASE II â€” INVESTIGAÃ‡ÃƒO',
      'ğŸ”',
      'As primeiras pistas vieram Ã  tona. Aprofunde os interrogatÃ³rios e confronte os suspeitos com evidÃªncias.');
  }
  if(done>=5 && G.phase===2){
    G.phase=3;
    updatePhase('FASE III â€” CONFRONTO',
      'âš¡',
      'VocÃª tem evidÃªncias suficientes. Confronte os suspeitos mais fortes. Detecte as Ãºltimas mentiras. Prepare-se para a acusaÃ§Ã£o.');
  }

  // Show accuse button
  if(done>=4) {
    document.getElementById('btn-accuse').classList.add('visible');
  }

  updateTopStats();
}

function updatePhase(title, icon, text) {
  document.getElementById('tb-phase').textContent = title;
  const banner=document.getElementById('phase-banner');
  if(banner){
    banner.querySelector('.phase-banner-icon').textContent=icon;
    banner.querySelector('.phase-banner-title').textContent=title;
    banner.querySelector('.phase-banner-text').textContent=text;
  }
}

function updateTopStats() {
  document.getElementById('stat-pistas').textContent=G.cluesFound.size;
  document.getElementById('stat-interr').textContent=G.charsInterrogated.size+'/8';
  document.getElementById('stat-mentiras').textContent=G.liesDetected.size;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ACCUSATION
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function openAccusation() {
  document.getElementById('game').style.display='none';
  const screen=document.getElementById('accusation-screen');
  screen.style.display='block';
  screen.style.animation='fadeIn .4s ease';

  const sorted = Object.entries(G.suspicion).sort((a,b)=>b[1]-a[1]);

  document.getElementById('accusation-form').innerHTML=`
    <div class="acc-field">
      <div class="acc-field-label">Quem vocÃª acusa pelo roubo do testamento?</div>
      <div class="acc-options" id="acc-culpado">
        ${sorted.map(([name])=>{
          const cfg=CHARACTERS[name];
          return `<button class="acc-option" onclick="selectAcc('culpado','${name}',this)">
            ${cfg.emoji} ${name}
          </button>`;
        }).join('')}
      </div>
    </div>

    <div class="acc-field">
      <div class="acc-field-label">Qual era o motivo?</div>
      <div class="acc-options" id="acc-motivo">
        <button class="acc-option" onclick="selectAcc('motivo','heranca',this)">HeranÃ§a em risco â€” perder tudo</button>
        <button class="acc-option" onclick="selectAcc('motivo','segredo',this)">Segredo comprometedor no documento</button>
        <button class="acc-option" onclick="selectAcc('motivo','vinganca',this)">VinganÃ§a familiar</button>
        <button class="acc-option" onclick="selectAcc('motivo','protecao',this)">Proteger outro herdeiro</button>
        <button class="acc-option" onclick="selectAcc('motivo','divida',this)">DÃ­vida desesperada â€” falta de dinheiro</button>
      </div>
    </div>

    <div class="acc-field">
      <div class="acc-field-label">Como o testamento foi acessado?</div>
      <div class="acc-options" id="acc-metodo">
        <button class="acc-option" onclick="selectAcc('metodo','combinacao',this)">CombinaÃ§Ã£o do cofre principal obtida antes</button>
        <button class="acc-option" onclick="selectAcc('metodo','chave',this)">Chave duplicada + cÃ³pia na caixa da adega</button>
        <button class="acc-option" onclick="selectAcc('metodo','cumplicidade',this)">Cumplicidade â€” dois envolvidos</button>
        <button class="acc-option" onclick="selectAcc('metodo','acidente',this)">Encontrou acidentalmente</button>
      </div>
    </div>

    <div class="acc-summary" id="acc-summary">
      Selecione acusado, motivo e mÃ©todo para confirmar.
    </div>

    <div class="acc-note">
      Pistas coletadas: <strong>${G.cluesFound.size}</strong> &nbsp;Â·&nbsp;
      Mentiras detectadas: <strong>${G.liesDetected.size}</strong> &nbsp;Â·&nbsp;
      InterrogaÃ§Ãµes: <strong>${G.charsInterrogated.size}/8</strong> &nbsp;Â·&nbsp;
      RevelaÃ§Ãµes-chave: <strong>${G.keyReveals.size}</strong><br>
      <em>Esta decisÃ£o Ã© irreversÃ­vel. A acusaÃ§Ã£o serÃ¡ julgada pelas evidÃªncias reais do caso.</em>
    </div>

    <button class="btn-confirm" id="btn-confirm" onclick="confirmAccusation()" disabled>
      âš– CONFIRMAR ACUSAÃ‡ÃƒO FORMAL
    </button>
  `;
}

function selectAcc(field, value, btn) {
  const container=document.getElementById(`acc-${field}`);
  container.querySelectorAll('.acc-option').forEach(b=>b.classList.remove('selected'));
  btn.classList.add('selected');
  G.accusationData[field]=value;
  updateAccSummary();
  const {culpado,motivo,metodo}=G.accusationData;
  if(culpado&&motivo&&metodo) document.getElementById('btn-confirm').disabled=false;
}

function updateAccSummary() {
  const {culpado,motivo,metodo}=G.accusationData;
  const el=document.getElementById('acc-summary');
  if(!el) return;
  if(culpado||motivo||metodo){
    el.innerHTML=`<strong>Sua acusaÃ§Ã£o:</strong> ${culpado||'?'} &nbsp;|&nbsp; ${motivo||'?'} &nbsp;|&nbsp; ${metodo||'?'}`;
  }
}

function confirmAccusation() {
  document.getElementById('accusation-screen').style.display='none';
  showEnding();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ENDING
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function showEnding() {
  const screen=document.getElementById('ending-screen');
  screen.style.display='block';
  const wrap=document.getElementById('ending-wrap');
  const {culpado,motivo,metodo}=G.accusationData;

  let storyKey,type;
  if(culpado==='Carluz'){
    if(motivo===TRUTH.motivo && metodo===TRUTH.metodo){storyKey='Carluz_perfeito';type='correct';}
    else if(motivo!==TRUTH.motivo){storyKey='Carluz_motivo_errado';type='partial';}
    else{storyKey='Carluz_metodo_errado';type='partial';}
  } else if(culpado==='Joy'){storyKey='Joy';type='wrong';}
  else if(culpado==='Mary'){storyKey='Mary';type='wrong';}
  else{storyKey='other';type='wrong';}

  const story=TRUTH.story[storyKey];
  const stampText=type==='correct'?'âœ¦ CASO RESOLVIDO COM MAESTRIA âœ¦':type==='partial'?'â— QUASE â€” ACUSADO CERTO':' âœ— ACUSAÃ‡ÃƒO INCORRETA';
  const stampClass=type;

  // Score
  const clueScore=Math.min(40,G.cluesFound.size*2.5);
  const lieScore=Math.min(25,G.liesDetected.size*6);
  const interrScore=Math.min(20,G.charsInterrogated.size*2.5);
  const keyScore=Math.min(15,G.keyReveals.size*5);
  const resultScore=type==='correct'?20:type==='partial'?10:0;
  const total=Math.round(clueScore+lieScore+interrScore+keyScore+resultScore);

  const ranks=[
    [90,'Sherlock Holmes'],
    [75,'HÃ©rcule Poirot'],
    [60,'Miss Marple'],
    [45,'Inspetor Morse'],
    [30,'Sam Spade'],
    [0,'Detetive Novato'],
  ];
  const rank=ranks.find(r=>total>=r[0]);

  // Truth comparison
  const cOk=culpado===TRUTH.culpado;
  const mOk=motivo===TRUTH.motivo;
  const meOk=metodo===TRUTH.metodo;

  wrap.innerHTML=`
    <div class="ending-stamp ${stampClass}">${stampText}</div>

    <div class="ending-paper">
      <div class="ending-headline">${story.headline}</div>
      <div class="ending-story">
        ${story.text.map(p=>`<p>${p}</p>`).join('')}
      </div>

      <div class="ending-reveal">
        <div class="ending-reveal-title">Sua AcusaÃ§Ã£o vs. A Verdade</div>
        <div class="truth-grid">
          <div class="truth-item">
            <div class="truth-label">Culpado</div>
            <div class="truth-val" style="color:${cOk?'#50d890':'var(--red3)'}">
              ${culpado || 'â€”'}<br>
              <span style="font-size:10px;color:var(--ink3)">(Real: Carluz)</span>
            </div>
          </div>
          <div class="truth-item">
            <div class="truth-label">Motivo</div>
            <div class="truth-val" style="color:${mOk?'#50d890':'var(--red3)'}">
              ${motivo || 'â€”'}<br>
              <span style="font-size:10px;color:var(--ink3)">(Real: DÃ­vida)</span>
            </div>
          </div>
          <div class="truth-item">
            <div class="truth-label">MÃ©todo</div>
            <div class="truth-val" style="color:${meOk?'#50d890':'var(--red3)'}">
              ${metodo || 'â€”'}<br>
              <span style="font-size:10px;color:var(--ink3)">(Real: Chave)</span>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div class="rank-display">
      <div class="rank-title">${rank?rank[1]:'Detetive'}</div>
      <div class="rank-label">Sua ClassificaÃ§Ã£o</div>
    </div>

    <div class="score-grid">
      <div class="score-item">
        <div class="score-val">${total}</div>
        <div class="score-lbl">PontuaÃ§Ã£o Final</div>
      </div>
      <div class="score-item">
        <div class="score-val">${G.cluesFound.size}/${ROOMS.reduce((a,r)=>a+r.clues.length,0)}</div>
        <div class="score-lbl">Pistas</div>
      </div>
      <div class="score-item">
        <div class="score-val">${G.liesDetected.size}</div>
        <div class="score-lbl">Mentiras</div>
      </div>
      <div class="score-item">
        <div class="score-val">${G.charsInterrogated.size}/8</div>
        <div class="score-lbl">InterrogaÃ§Ãµes</div>
      </div>
    </div>

    <button class="btn-restart" onclick="restartGame()">â†º NOVO CASO â€” REINICIAR</button>
  `;
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  UTILS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function closeModal() {
  document.getElementById('modal-overlay').classList.remove('open');
}

function handleOverlayClick(e) {
  if(e.target===document.getElementById('modal-overlay')) closeModal();
}

let _toastTimer;
function showToast(msg) {
  const t=document.getElementById('toast');
  document.getElementById('toast-text').textContent=msg;
  t.style.display='flex';t.style.opacity='1';t.style.transform='none';
  clearTimeout(_toastTimer);
  _toastTimer=setTimeout(()=>{
    t.style.transition='opacity .4s';t.style.opacity='0';
    setTimeout(()=>{t.style.display='none';t.style.transition='';},400);
  },3500);
}

function restartGame() {
  G={
    cluesFound:new Set(),roomsVisited:new Set(),
    charsInterrogated:new Set(),questionsAsked:{},
    suspicion:{Pollyana:0,Carluz:0,Eros:0,Stephany:0,Mary:0,Mel:0,Joy:0,Ellie:0},
    liesDetected:new Set(),connections:new Set(),
    timelineEntries:[],accusationData:{culpado:'',motivo:'',metodo:''},
    phase:1,keyReveals:new Set(),
  };
  document.getElementById('ending-screen').style.display='none';
  document.getElementById('game').style.display='block';
  document.getElementById('btn-accuse').classList.remove('visible');
  document.getElementById('tb-phase').textContent='FASE I â€” CHEGADA';
  document.getElementById('evidence-list').innerHTML='<div style="font-size:12px;font-style:italic;color:var(--ink4)">Nenhuma evidÃªncia ainda.<br>Investigue os cÃ´modos.</div>';
  document.getElementById('timeline-list').innerHTML='<div style="font-size:11px;font-style:italic;color:var(--ink4)">ConstruÃ­da Ã  medida que vocÃª investiga...</div>';
  document.getElementById('connections-list').innerHTML='<div style="font-size:11px;font-style:italic;color:var(--ink4)">Descobertas ao interrogar...</div>';
  document.getElementById('notes-area').value='';
  document.getElementById('theory-culpado').value='';
  document.getElementById('theory-motivo').value='';
  document.getElementById('theory-metodo').value='';
  const phaseBanner=document.getElementById('phase-banner');
  if(phaseBanner){
    phaseBanner.querySelector('.phase-banner-icon').textContent='ğŸ›ï¸';
    phaseBanner.querySelector('.phase-banner-title').textContent='Fase I â€” A Chegada';
    phaseBanner.querySelector('.phase-banner-text').textContent='Comece investigando os cÃ´modos da villa e interrogando os herdeiros. As primeiras pistas revelarÃ£o quem tinha acesso ao cofre.';
  }
  buildAlibiList();
  buildRoomsGrid();
  buildCharsGrid();
  buildSuspectMeters();
  buildProgressList();
  updateTopStats();
}
</script>
</body>
</html>
